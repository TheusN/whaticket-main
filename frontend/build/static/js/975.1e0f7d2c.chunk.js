"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[975],{3863:(e,t,s)=>{s.d(t,{A:()=>l});s(9950);var a=s(39886),n=s(44414);function l(e){return(0,n.jsx)(a.A,{variant:"h5",color:"primary",gutterBottom:!0,children:e.children})}},17885:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var a=s(89379),n=s(9950),l=s(85923),o=s(16673),c=s(69994),r=s(77882),i=s(52816),d=s(32018),u=s(59428),m=s(86505),h=s(38847),p=s(3863),A=s(45530),g=s(33906),f=s(39655),x=s(68815),y=s(60995),v=s(77534),b=s(59051),j=s.n(b),R=s(23665),w=s(18957),S=(s(65774),s(57720)),C=(s(93217),s(66379),s(16714)),E=s(33043),k=s(36386);s(30257),s(93204);var I=s(44414);const D={fontSize:"14px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"};var M={date:g.R.t("schedules.messages.date"),time:g.R.t("schedules.messages.time"),event:g.R.t("schedules.messages.event"),allDay:g.R.t("schedules.messages.allDay"),week:g.R.t("schedules.messages.week"),work_week:g.R.t("schedules.messages.work_week"),day:g.R.t("schedules.messages.day"),month:g.R.t("schedules.messages.month"),previous:g.R.t("schedules.messages.previous"),next:g.R.t("schedules.messages.next"),yesterday:g.R.t("schedules.messages.yesterday"),tomorrow:g.R.t("schedules.messages.tomorrow"),today:g.R.t("schedules.messages.today"),agenda:g.R.t("schedules.messages.agenda"),noEventsInRange:g.R.t("schedules.messages.noEventsInRange"),showMore:function(e){return"+"+e+" "+g.R.t("schedules.messages.showMore")}};const P=(e,t)=>{if("LOAD_SCHEDULES"===t.type)return[...e,...t.payload];if("UPDATE_SCHEDULES"===t.type){const s=t.payload,a=e.findIndex(e=>e.id===s.id);return-1!==a?(e[a]=s,[...e]):[s,...e]}if("DELETE_SCHEDULE"===t.type){const s=t.payload;return e.filter(e=>e.id!==s)}return"RESET"===t.type?[]:e},L=(0,c.A)(e=>({mainPaper:(0,a.A)({flex:1,padding:e.spacing(1),overflowY:"scroll"},e.scrollbarStyles)})),N=()=>{const e=(()=>{const e=localStorage.getItem("i18nextLng")||"en";return j().locale("pt"===e?"pt-br":e),(0,S.ye)(j())})(),t=L(),{user:s}=((0,o.useHistory)(),(0,n.useContext)(w.c)),[a,c]=(0,n.useState)(!1),[b,N]=(0,n.useState)(1),[T,H]=(0,n.useState)(!1),[W,Y]=(0,n.useState)(null),[F,V]=(0,n.useState)(null),[O,U]=(0,n.useState)(!1),[_,z]=(0,n.useState)(""),[B,q]=(0,n.useReducer)(P,[]),[G,J]=(0,n.useState)(!1),[K,Q]=(0,n.useState)((X="contactId",+new URLSearchParams(window.location.search).get(X)));var X;const Z=(0,n.useCallback)(async()=>{try{const{data:e}=await A.A.get("/schedules/",{params:{searchParam:_,pageNumber:b}});q({type:"LOAD_SCHEDULES",payload:e.schedules}),H(e.hasMore),c(!1)}catch(e){(0,v.A)(e)}},[_,b]),$=(0,n.useCallback)(()=>{K&&te()},[K]),ee=(0,n.useContext)(R.d);(0,n.useEffect)(()=>{q({type:"RESET"}),N(1)},[_]),(0,n.useEffect)(()=>{c(!0);const e=setTimeout(()=>{Z()},500);return()=>clearTimeout(e)},[_,b,K,Z,$]),(0,n.useEffect)(()=>{$();const e=ee.getSocket(s.companyId);return e.on("company".concat(s.companyId,"-schedule"),e=>{"update"!==e.action&&"create"!==e.action||q({type:"UPDATE_SCHEDULES",payload:e.schedule}),"delete"===e.action&&q({type:"DELETE_SCHEDULE",payload:+e.scheduleId})}),()=>{e.disconnect()}},[$,ee,s]);const te=()=>{Y(null),J(!0)},se=async e=>{try{await A.A.delete("/schedules/".concat(e)),l.oR.success(g.R.t("schedules.toasts.deleted"))}catch(t){(0,v.A)(t)}V(null),z(""),N(1),q({type:"RESET"}),N(1),await Z()};return(0,I.jsxs)(m.A,{children:[(0,I.jsx)(y.A,{title:F&&"".concat(g.R.t("schedules.confirmationModal.deleteTitle")),open:O,onClose:()=>U(!1),onConfirm:()=>se(F.id),children:g.R.t("schedules.confirmationModal.deleteMessage")}),(0,I.jsx)(x.A,{open:G,onClose:()=>{Y(null),J(!1)},reload:Z,"aria-labelledby":"form-dialog-title",scheduleId:W&&W.id,contactId:K,cleanContact:()=>{Q("")}}),(0,I.jsxs)(h.A,{children:[(0,I.jsxs)(p.A,{children:[g.R.t("schedules.title")," (",B.length,")"]}),(0,I.jsxs)(f.A,{children:[(0,I.jsx)(d.A,{placeholder:g.R.t("contacts.searchPlaceholder"),type:"search",value:_,onChange:e=>{z(e.target.value.toLowerCase())},InputProps:{startAdornment:(0,I.jsx)(u.A,{position:"start",children:(0,I.jsx)(C.A,{style:{color:"gray"}})})}}),(0,I.jsx)(i.A,{variant:"contained",color:"primary",onClick:te,children:g.R.t("schedules.buttons.add")})]})]}),(0,I.jsx)(r.A,{className:t.mainPaper,variant:"outlined",onScroll:e=>{if(!T||a)return;const{scrollTop:t,scrollHeight:s,clientHeight:n}=e.currentTarget;s-(t+100)<n&&N(e=>e+1)},children:(0,I.jsx)(S.Vv,{messages:M,formats:{agendaDateFormat:"DD/MM ddd",weekdayFormat:"dddd"},localizer:e,events:B.map(e=>({title:(0,I.jsxs)("div",{className:"event-container",children:[(0,I.jsx)("div",{style:D,children:e.contact.name}),(0,I.jsx)(E.A,{onClick:()=>se(e.id),className:"delete-icon"}),(0,I.jsx)(k.A,{onClick:()=>{(e=>{Y(e),J(!0)})(e),J(!0)},className:"edit-icon"})]}),start:new Date(e.sendAt),end:new Date(e.sendAt)})),startAccessor:"start",endAccessor:"end",style:{height:500}})})]})}},38847:(e,t,s)=>{s.d(t,{A:()=>o});s(9950);var a=s(69994),n=s(44414);const l=(0,a.A)(e=>({contactsHeader:{display:"flex",alignItems:"center",padding:"0px 6px 6px 6px"}})),o=e=>{let{children:t}=e;const s=l();return(0,n.jsx)("div",{className:s.contactsHeader,children:t})}},39655:(e,t,s)=>{s.d(t,{A:()=>o});s(9950);var a=s(69994),n=s(44414);const l=(0,a.A)(e=>({MainHeaderButtonsWrapper:{flex:"none",marginLeft:"auto","& > *":{margin:e.spacing(1)}}})),o=e=>{let{children:t}=e;const s=l();return(0,n.jsx)("div",{className:s.MainHeaderButtonsWrapper,children:t})}},68815:(e,t,s)=>{s.d(t,{A:()=>H});var a=s(89379),n=s(9950),l=s(29714),o=s(6443),c=s(85923),r=s(16673),i=s(69994),d=s(46493),u=s(52816),m=s(32018),h=s(18028),p=s(43510),A=s(77766),g=s(96918),f=s(80892),x=s(33906),y=s(45530),v=s(77534),b=s(12630),j=s(32988),R=s(97226),w=s(23386),S=s(59051),C=s.n(S),E=s(18957),k=s(41397),I=s(33043),D=s(80877),M=s(60995),P=s(85185),L=s(44414);const N=(0,i.A)(e=>({root:{display:"flex",flexWrap:"wrap"},multFieldLine:{display:"flex","& > *:not(:last-child)":{marginRight:e.spacing(1)}},btnWrapper:{position:"relative"},buttonProgress:{color:d.A[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12},formControl:{margin:e.spacing(1),minWidth:120}})),T=l.Ik().shape({body:l.Yj().min(5,"Mensagem muito curta").required("Obrigat\xf3rio"),contactId:l.ai().required("Obrigat\xf3rio"),sendAt:l.Yj().required("Obrigat\xf3rio")}),H=e=>{let{open:t,onClose:s,scheduleId:l,contactId:i,cleanContact:d,reload:S}=e;const H=N(),W=(0,r.useHistory)(),{user:Y}=(0,n.useContext)(E.c),F={body:"",contactId:"",sendAt:C()().add(1,"hour").format("YYYY-MM-DDTHH:mm"),sentAt:""},V={id:"",name:""},[O,U]=(0,n.useState)(F),[_,z]=(0,n.useState)(V),[B,q]=(0,n.useState)([V]),[G,J]=(0,n.useState)(null),K=(0,n.useRef)(null),[Q,X]=(0,n.useState)(!1),Z=(0,n.useRef)();(0,n.useEffect)(()=>{if(i&&B.length){const e=B.find(e=>e.id===i);e&&z(e)}},[i,B]),(0,n.useEffect)(()=>{const{companyId:e}=Y;if(t)try{(async()=>{const{data:t}=await y.A.get("/contacts/list",{params:{companyId:e}});let s=t.map(e=>({id:e.id,name:e.name}));if((0,k.isArray)(s)&&q([{id:"",name:""},...s]),i&&U(e=>(0,a.A)((0,a.A)({},e),{},{contactId:i})),!l)return;const{data:n}=await y.A.get("/schedules/".concat(l));U(e=>(0,a.A)((0,a.A)((0,a.A)({},e),n),{},{sendAt:C()(n.sendAt).format("YYYY-MM-DDTHH:mm")})),z(n.contact)})()}catch(s){(0,v.A)(s)}},[l,i,t,Y]);const $=()=>{s(),J(null),U(F)};return(0,L.jsxs)("div",{className:H.root,children:[(0,L.jsx)(M.A,{title:x.R.t("scheduleModal.confirmationModal.deleteTitle"),open:Q,onClose:()=>X(!1),onConfirm:async()=>{G&&(J(null),K.current.value=null),O.mediaPath&&(await y.A.delete("/schedules/".concat(O.id,"/media-upload")),U(e=>(0,a.A)((0,a.A)({},e),{},{mediaPath:null})),c.oR.success(x.R.t("scheduleModal.toasts.deleted")),"function"==typeof S&&(console.log(S),console.log("1"),S()))},children:x.R.t("scheduleModal.confirmationModal.deleteMessage")}),(0,L.jsxs)(h.A,{open:t,onClose:$,maxWidth:"xs",fullWidth:!0,scroll:"paper",children:[(0,L.jsx)(g.A,{id:"form-dialog-title",children:"ERRO"===O.status?"Erro de Envio":"Mensagem ".concat((0,k.capitalize)(O.status))}),(0,L.jsx)("div",{style:{display:"none"},children:(0,L.jsx)("input",{type:"file",accept:".png,.jpg,.jpeg",ref:K,onChange:e=>(e=>{const t=(0,k.head)(e.target.files);t&&J(t)})(e)})}),(0,L.jsx)(o.l1,{initialValues:O,enableReinitialize:!0,validationSchema:T,onSubmit:(e,t)=>{setTimeout(()=>{(async e=>{const t=(0,a.A)((0,a.A)({},e),{},{userId:Y.id});try{if(l){if(await y.A.put("/schedules/".concat(l),t),null!=G){const e=new FormData;e.append("file",G),await y.A.post("/schedules/".concat(l,"/media-upload"),e)}}else{const{data:e}=await y.A.post("/schedules",t);if(null!=G){const t=new FormData;t.append("file",G),await y.A.post("/schedules/".concat(e.id,"/media-upload"),t)}}c.oR.success(x.R.t("scheduleModal.success")),"function"==typeof S&&S(),i&&"function"===typeof d&&(d(),W.push("/schedules"))}catch(s){(0,v.A)(s)}z(V),U(F),$()})(e),t.setSubmitting(!1)},400)},children:e=>{let{touched:t,errors:s,isSubmitting:n,values:c,setFieldValue:r}=e;return(0,L.jsxs)(o.lV,{children:[(0,L.jsxs)(A.A,{dividers:!0,children:[(0,L.jsx)("div",{className:H.multFieldLine,children:(0,L.jsx)(b.A,{variant:"outlined",fullWidth:!0,children:(0,L.jsx)(w.Ay,{fullWidth:!0,value:_,options:B,onChange:(e,t)=>{const s=t?t.id:"";U((0,a.A)((0,a.A)({},O),{},{contactId:s})),z(t||V)},getOptionLabel:e=>e.name,getOptionSelected:(e,t)=>t.id===e.id,renderInput:e=>(0,L.jsx)(m.A,(0,a.A)((0,a.A)({},e),{},{variant:"outlined",placeholder:"Contato"}))})})}),(0,L.jsx)("br",{}),(0,L.jsx)("div",{className:H.multFieldLine,children:(0,L.jsx)(o.D0,{as:m.A,rows:9,multiline:!0,label:x.R.t("scheduleModal.form.body"),name:"body",inputRef:Z,error:t.body&&Boolean(s.body),helperText:t.body&&s.body,variant:"outlined",margin:"dense",fullWidth:!0})}),(0,L.jsx)(j.A,{item:!0,children:(0,L.jsx)(P.A,{disabled:n,onClick:e=>(async(e,t)=>{const s=Z.current,a=s.value.substring(0,s.selectionStart),n=s.value.substring(s.selectionEnd),l=s.selectionStart+e.length;t("body","".concat(a).concat(e).concat(n)),await new Promise(e=>setTimeout(e,100)),Z.current.setSelectionRange(l,l)})(e,r)})}),(0,L.jsx)("br",{}),(0,L.jsx)("div",{className:H.multFieldLine,children:(0,L.jsx)(o.D0,{as:m.A,label:x.R.t("scheduleModal.form.sendAt"),type:"datetime-local",name:"sendAt",InputLabelProps:{shrink:!0},error:t.sendAt&&Boolean(s.sendAt),helperText:t.sendAt&&s.sendAt,variant:"outlined",fullWidth:!0})}),(O.mediaPath||G)&&(0,L.jsxs)(j.A,{xs:12,item:!0,children:[(0,L.jsx)(u.A,{startIcon:(0,L.jsx)(D.A,{}),children:G?G.name:O.mediaName}),(0,L.jsx)(R.A,{onClick:()=>X(!0),color:"secondary",children:(0,L.jsx)(I.A,{color:"secondary"})})]})]}),(0,L.jsxs)(p.A,{children:[!G&&!O.mediaPath&&(0,L.jsx)(u.A,{color:"primary",onClick:()=>K.current.click(),disabled:n,variant:"outlined",children:x.R.t("quickMessages.buttons.attach")}),(0,L.jsx)(u.A,{onClick:$,color:"secondary",disabled:n,variant:"outlined",children:x.R.t("scheduleModal.buttons.cancel")}),(null===O.sentAt||""===O.sentAt)&&(0,L.jsxs)(u.A,{type:"submit",color:"primary",disabled:n,variant:"contained",className:H.btnWrapper,children:["".concat(l?x.R.t("scheduleModal.buttons.okEdit"):x.R.t("scheduleModal.buttons.okAdd")),n&&(0,L.jsx)(f.A,{size:24,className:H.buttonProgress})]})]})]})}})]})]})}},85185:(e,t,s)=>{s.d(t,{A:()=>A});s(9950);var a=s(69994),n=s(11647),l=s(33906),o=s(89379),c=s(80045),r=s(32018),i=s(44414);const d=["inputRef"],u=["InputProps","children","InputLabelProps","label"],m=e=>{let{inputRef:t}=e,s=(0,c.A)(e,d);return(0,i.jsx)("div",(0,o.A)({},s))},h=e=>{let{InputProps:t,children:s,InputLabelProps:a,label:n}=e,l=(0,c.A)(e,u);return(0,i.jsx)(r.A,(0,o.A)((0,o.A)({},l),{},{variant:"outlined",label:n,multiline:!0,InputLabelProps:(0,o.A)({shrink:!0},a),InputProps:(0,o.A)({inputComponent:m},t),inputProps:{children:s}}))},p=(0,a.A)(e=>({chip:{margin:e.spacing(.5),cursor:"pointer"}})),A=e=>{let{onClick:t,disabled:s}=e;const a=p(),o=[{name:l.R.t("messageVariablesPicker.vars.contactFirstName"),value:"{{firstName}}"},{name:l.R.t("messageVariablesPicker.vars.contactName"),value:"{{name}} "},{name:l.R.t("messageVariablesPicker.vars.greeting"),value:"{{ms}} "},{name:l.R.t("messageVariablesPicker.vars.protocolNumber"),value:"{{protocol}} "},{name:l.R.t("messageVariablesPicker.vars.hour"),value:"{{hora}} "}];return(0,i.jsx)(h,{margin:"dense",fullWidth:!0,label:l.R.t("messageVariablesPicker.label"),disabled:s,children:o.map(e=>(0,i.jsx)(n.A,{onMouseDown:a=>((e,a)=>{e.preventDefault(),s||t(a)})(a,e.value),label:e.name,size:"small",className:a.chip,color:"primary"},e.value))})}},86505:(e,t,s)=>{s.d(t,{A:()=>c});s(9950);var a=s(69994),n=s(54742),l=s(44414);const o=(0,a.A)(e=>({mainContainer:{flex:1,padding:e.spacing(2),height:"calc(100% - 48px)"},contentWrapper:{height:"100%",overflowY:"hidden",display:"flex",flexDirection:"column"}})),c=e=>{let{children:t}=e;const s=o();return(0,l.jsx)(n.A,{className:s.mainContainer,children:(0,l.jsx)("div",{className:s.contentWrapper,children:t})})}}}]);