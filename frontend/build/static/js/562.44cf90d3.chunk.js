"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[562],{42562:(t,e,a)=>{a.r(e),a.d(e,{default:()=>Z});var n=a(89379),s=a(9950),c=a(85923),i=a(16673),o=a(69994),l=a(49986),r=a(80158),d=a(5386),m=a(37874),u=a(92560),h=a(77882),p=a(52816),A=a(16714),x=a(32018),f=a(59428),j=a(97226),y=a(33043),g=a(36386),C=a(80684),b=a(64781),I=a(45530),R=a(42239),L=a(29714),T=a(6443),v=a(46493),S=a(18028),E=a(43510),w=a(77766),M=a(96918),k=a(39886),N=a(80892),O=a(33906),P=a(77534),D=a(18957),W=a(44414);const z=(0,o.A)(t=>({root:{display:"flex",flexWrap:"wrap"},textField:{marginRight:t.spacing(1),flex:1},extraAttr:{display:"flex",justifyContent:"center",alignItems:"center"},btnWrapper:{position:"relative"},buttonProgress:{color:v.A[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}})),q=L.Ik().shape({name:L.Yj().min(2,O.R.t("contactListItems.dialog.nameShort")).max(50,O.R.t("contactListItems.dialog.nameLong")).required(O.R.t("contactListItems.dialog.nameRequired")),number:L.Yj().min(8,O.R.t("contactListItems.dialog.numberShort")).max(50,O.R.t("contactListItems.dialog.numberLong")),email:L.Yj().email(O.R.t("contactListItems.dialog.emailInvalid"))}),_=t=>{let{open:e,onClose:a,contactId:o,initialValues:l,onSave:r}=t;const d=z(),m=(0,s.useRef)(!0),{user:{companyId:u}}=(0,s.useContext)(D.c),{contactListId:h}=(0,i.useParams)(),A={name:"",number:"",email:""},[f,j]=(0,s.useState)(A);(0,s.useEffect)(()=>()=>{m.current=!1},[]),(0,s.useEffect)(()=>{(async()=>{if(l&&j(t=>(0,n.A)((0,n.A)({},t),l)),o)try{const{data:t}=await I.A.get("/contact-list-items/".concat(o));m.current&&j(t)}catch(t){(0,P.A)(t)}})()},[o,e,l]);const y=()=>{a(),j(A)};return(0,W.jsx)("div",{className:d.root,children:(0,W.jsxs)(S.A,{open:e,onClose:y,maxWidth:"lg",scroll:"paper",children:[(0,W.jsx)(M.A,{id:"form-dialog-title",children:"".concat(o?O.R.t("contactModal.title.edit"):O.R.t("contactModal.title.add"))}),(0,W.jsx)(T.l1,{initialValues:f,enableReinitialize:!0,validationSchema:q,onSubmit:(t,e)=>{setTimeout(()=>{(async t=>{try{if(o)await I.A.put("/contact-list-items/".concat(o),(0,n.A)((0,n.A)({},t),{},{companyId:u,contactListId:h})),y();else{const{data:e}=await I.A.post("/contact-list-items",(0,n.A)((0,n.A)({},t),{},{companyId:u,contactListId:h}));r&&r(e),y()}c.oR.success(O.R.t("contactModal.success"))}catch(e){(0,P.A)(e)}})(t),e.setSubmitting(!1)},400)},children:t=>{let{values:e,errors:a,touched:n,isSubmitting:s}=t;return(0,W.jsxs)(T.lV,{children:[(0,W.jsxs)(w.A,{dividers:!0,children:[(0,W.jsx)(k.A,{variant:"subtitle1",gutterBottom:!0,children:O.R.t("contactModal.form.mainInfo")}),(0,W.jsx)(T.D0,{as:x.A,label:O.R.t("contactModal.form.name"),name:"name",autoFocus:!0,error:n.name&&Boolean(a.name),helperText:n.name&&a.name,variant:"outlined",margin:"dense",className:d.textField}),(0,W.jsx)(T.D0,{as:x.A,label:O.R.t("contactModal.form.number"),name:"number",error:n.number&&Boolean(a.number),helperText:n.number&&a.number,placeholder:"5513912344321",variant:"outlined",margin:"dense"}),(0,W.jsx)("div",{children:(0,W.jsx)(T.D0,{as:x.A,label:O.R.t("contactModal.form.email"),name:"email",error:n.email&&Boolean(a.email),helperText:n.email&&a.email,placeholder:O.R.t("contactModal.form.email"),fullWidth:!0,margin:"dense",variant:"outlined"})})]}),(0,W.jsxs)(E.A,{children:[(0,W.jsx)(p.A,{onClick:y,color:"secondary",disabled:s,variant:"outlined",children:O.R.t("contactModal.buttons.cancel")}),(0,W.jsxs)(p.A,{type:"submit",color:"primary",disabled:s,variant:"contained",className:d.btnWrapper,children:["".concat(o?O.R.t("contactModal.buttons.okEdit"):O.R.t("contactModal.buttons.okAdd")),s&&(0,W.jsx)(N.A,{size:24,className:d.buttonProgress})]})]})]})}})]})})};var B=a(60995),F=a(38847),V=a(3863),Y=a(86505),H=a(52776);const U=()=>({findById:async t=>{const{data:e}=await I.A.request({url:"/contact-lists/".concat(t),method:"GET"});return e},save:async t=>{const{data:e}=await I.A.request({url:"/contact-lists",method:"POST",data:t});return e},update:async t=>{const{data:e}=await I.A.request({url:"/contact-lists/".concat(t.id),method:"PUT",data:t});return e},deleteRecord:async t=>{const{data:e}=await I.A.request({url:"/contact-lists/".concat(t),method:"DELETE"});return e},list:async t=>{const{data:e}=await I.A.request({url:"/contact-lists/list",method:"GET",params:t});return e}});var G=a(32988),J=a(48484),K=a(23665);const Q=(t,e)=>{if("LOAD_CONTACTS"===e.type){const a=e.payload,n=[];return a.forEach(e=>{const a=t.findIndex(t=>t.id===e.id);-1!==a?t[a]=e:n.push(e)}),[...t,...n]}if("UPDATE_CONTACTS"===e.type){const a=e.payload,n=t.findIndex(t=>t.id===a.id);return-1!==n?(t[n]=a,[...t]):[a,...t]}if("DELETE_CONTACT"===e.type){const a=e.payload,n=t.findIndex(t=>t.id===a);return-1!==n&&t.splice(n,1),[...t]}if("RESET"===e.type)return[]},X=(0,o.A)(t=>({mainPaper:(0,n.A)({flex:1,padding:t.spacing(1),overflowY:"scroll"},t.scrollbarStyles)})),Z=()=>{const t=X(),{user:e}=(0,s.useContext)(D.c),{contactListId:a}=(0,i.useParams)(),n=(0,i.useHistory)(),[o,L]=(0,s.useState)(!1),[T,v]=(0,s.useState)(1),[S,E]=(0,s.useState)(""),[w,M]=(0,s.useReducer)(Q,[]),[k,N]=(0,s.useState)(null),[z,q]=(0,s.useState)(!1),[Z,$]=(0,s.useState)(null),[tt,et]=(0,s.useState)(!1),[at,nt]=(0,s.useState)(!1),[st,ct]=(0,s.useState)({}),it=(0,s.useRef)(null),{findById:ot}=U(),lt=(0,s.useContext)(K.d);(0,s.useEffect)(()=>{ot(a).then(t=>{ct(t)})},[a]),(0,s.useEffect)(()=>{M({type:"RESET"}),v(1)},[S]),(0,s.useEffect)(()=>{L(!0);const t=setTimeout(()=>{(async()=>{try{const{data:t}=await I.A.get("contact-list-items",{params:{searchParam:S,pageNumber:T,contactListId:a}});M({type:"LOAD_CONTACTS",payload:t.contacts}),nt(t.hasMore),L(!1)}catch(t){(0,P.A)(t)}})()},500);return()=>clearTimeout(t)},[S,T,a]),(0,s.useEffect)(()=>{const t=localStorage.getItem("companyId"),e=lt.getSocket(t);return e.on("company-".concat(t,"-ContactListItem"),t=>{"update"!==t.action&&"create"!==t.action||M({type:"UPDATE_CONTACTS",payload:t.record}),"delete"===t.action&&M({type:"DELETE_CONTACT",payload:+t.id}),"reload"===t.action&&M({type:"LOAD_CONTACTS",payload:t.records})}),e.on("company-".concat(t,"-ContactListItem-").concat(a),t=>{"reload"===t.action&&M({type:"LOAD_CONTACTS",payload:t.records})}),()=>{e.disconnect()}},[a,lt]);return(0,W.jsxs)(Y.A,{className:t.mainContainer,children:[(0,W.jsx)(_,{open:z,onClose:()=>{N(null),q(!1)},"aria-labelledby":"form-dialog-title",contactId:k}),(0,W.jsx)(B.A,{title:Z?"".concat(O.R.t("contactListItems.confirmationModal.deleteTitle")," ").concat(Z.name,"?"):"".concat(O.R.t("contactListItems.confirmationModal.importTitlte")),open:tt,onClose:et,onConfirm:()=>Z?(async t=>{try{await I.A.delete("/contact-list-items/".concat(t)),c.oR.success(O.R.t("contacts.toasts.deleted"))}catch(e){(0,P.A)(e)}$(null),E(""),v(1)})(Z.id):(async()=>{try{const t=new FormData;t.append("file",it.current.files[0]),await I.A.request({url:"contact-lists/".concat(a,"/upload"),method:"POST",data:t})}catch(t){(0,P.A)(t)}})(),children:Z?"".concat(O.R.t("contactListItems.confirmationModal.deleteMessage")):(0,W.jsxs)(W.Fragment,{children:[O.R.t("contactListItems.confirmationModal.importMessage"),(0,W.jsx)("a",{href:J,download:"planilha.xlsx",children:O.R.t("contactListItems.download")})]})}),(0,W.jsx)(F.A,{children:(0,W.jsxs)(G.A,{style:{width:"99.6%"},container:!0,children:[(0,W.jsx)(G.A,{xs:12,sm:5,item:!0,children:(0,W.jsx)(V.A,{children:st.name})}),(0,W.jsx)(G.A,{xs:12,sm:7,item:!0,children:(0,W.jsxs)(G.A,{spacing:2,container:!0,children:[(0,W.jsx)(G.A,{xs:12,sm:6,item:!0,children:(0,W.jsx)(x.A,{fullWidth:!0,placeholder:O.R.t("contactListItems.searchPlaceholder"),type:"search",value:S,onChange:t=>{E(t.target.value.toLowerCase())},InputProps:{startAdornment:(0,W.jsx)(f.A,{position:"start",children:(0,W.jsx)(A.A,{style:{color:"gray"}})})}})}),(0,W.jsx)(G.A,{xs:4,sm:2,item:!0,children:(0,W.jsx)(p.A,{fullWidth:!0,variant:"contained",color:"primary",onClick:()=>{n.push("/contact-lists")},children:O.R.t("contactListItems.buttons.lists")})}),(0,W.jsx)(G.A,{xs:4,sm:2,item:!0,children:(0,W.jsx)(p.A,{fullWidth:!0,variant:"contained",color:"primary",onClick:()=>{it.current.value=null,it.current.click()},children:O.R.t("contactListItems.buttons.import")})}),(0,W.jsx)(G.A,{xs:4,sm:2,item:!0,children:(0,W.jsx)(p.A,{fullWidth:!0,variant:"contained",color:"primary",onClick:()=>{N(null),q(!0)},children:O.R.t("contactListItems.buttons.add")})})]})})]})}),(0,W.jsxs)(h.A,{className:t.mainPaper,variant:"outlined",onScroll:t=>{if(!at||o)return;const{scrollTop:e,scrollHeight:a,clientHeight:n}=t.currentTarget;a-(e+100)<n&&v(t=>t+1)},children:[(0,W.jsx)(W.Fragment,{children:(0,W.jsx)("input",{style:{display:"none"},id:"upload",name:"file",type:"file",accept:".xls,.xlsx",onChange:()=>{et(!0)},ref:it})}),(0,W.jsxs)(l.A,{size:"small",children:[(0,W.jsx)(m.A,{children:(0,W.jsxs)(u.A,{children:[(0,W.jsx)(d.A,{align:"center",style:{width:"0%"},children:"#"}),(0,W.jsx)(d.A,{children:O.R.t("contactListItems.table.name")}),(0,W.jsx)(d.A,{align:"center",children:O.R.t("contactListItems.table.number")}),(0,W.jsx)(d.A,{align:"center",children:O.R.t("contactListItems.table.email")}),(0,W.jsx)(d.A,{align:"center",children:O.R.t("contactListItems.table.actions")})]})}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(W.Fragment,{children:[w.map(t=>(0,W.jsxs)(u.A,{children:[(0,W.jsx)(d.A,{align:"center",style:{width:"0%"},children:(0,W.jsx)(j.A,{children:t.isWhatsappValid?(0,W.jsx)(C.A,{titleAccess:"Whatsapp V\xe1lido",htmlColor:"green"}):(0,W.jsx)(b.A,{titleAccess:"Whatsapp Inv\xe1lido",htmlColor:"grey"})})}),(0,W.jsx)(d.A,{children:t.name}),(0,W.jsx)(d.A,{align:"center",children:t.number}),(0,W.jsx)(d.A,{align:"center",children:t.email}),(0,W.jsxs)(d.A,{align:"center",children:[(0,W.jsx)(j.A,{size:"small",onClick:()=>{return e=t.id,N(e),void q(!0);var e},children:(0,W.jsx)(g.A,{})}),(0,W.jsx)(H.T,{role:e.profile,perform:"contacts-page:deleteContact",yes:()=>(0,W.jsx)(j.A,{size:"small",onClick:()=>{et(!0),$(t)},children:(0,W.jsx)(y.A,{})})})]})]},t.id)),o&&(0,W.jsx)(R.A,{columns:4})]})})]})]})]})}},64781:(t,e,a)=>{var n=a(24994),s=a(6305);e.A=void 0;var c=s(a(9950)),i=(0,n(a(53209)).default)(c.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"}),"Block");e.A=i},80684:(t,e,a)=>{var n=a(24994),s=a(6305);e.A=void 0;var c=s(a(9950)),i=(0,n(a(53209)).default)(c.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckCircle");e.A=i}}]);