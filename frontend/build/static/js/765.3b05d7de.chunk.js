"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[765],{26260:(e,t,a)=>{var i=a(24994),n=a(6305);t.A=void 0;var s=n(a(9950)),r=(0,i(a(53209)).default)(s.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.A=r},37126:(e,t,a)=>{a.d(t,{Ay:()=>p,o4:()=>u});var i=a(58168),n=a(80045),s=a(9950),r=a(85531),o=a(23876),l=a.n(o),d=a(14602),c=a(53084),h=a(94982),u=function(e,t){return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?c.H.indexOf(e)<=c.H.indexOf(t):c.H.indexOf(e)<c.H.indexOf(t)},m="undefined"===typeof window?s.useEffect:s.useLayoutEffect;const p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var a=e.withTheme,o=void 0!==a&&a,c=e.noSSR,u=void 0!==c&&c,p=e.initialWidth;function x(e){var a=(0,d.A)(),l=e.theme||a,c=(0,r.A)({theme:l,name:"MuiWithWidth",props:(0,i.A)({},e)}),x=c.initialWidth,g=c.width,f=(0,n.A)(c,["initialWidth","width"]),A=s.useState(!1),b=A[0],j=A[1];m(function(){j(!0)},[]);var v=l.breakpoints.keys.slice().reverse().reduce(function(e,t){var a=(0,h.A)(l.breakpoints.up(t));return!e&&a?t:e},null),y=(0,i.A)({width:g||(b||u?v:void 0)||x||p},o?{theme:l}:{},f);return void 0===y.width?null:s.createElement(t,y)}return l()(x,t),x}}},41765:(e,t,a)=>{a.r(t),a.d(t,{ChatModal:()=>V,default:()=>q});var i=a(89379),n=a(9950),s=a(16673),r=a(69994),o=a(18028),l=a(96918),d=a(77766),c=a(32988),h=a(32018),u=a(43510),m=a(52816),p=a(20763),x=a(96502),g=a(77882),f=a(11647),A=a(84580),b=a(29206),j=a(81788),v=a(3546),y=a(97226),C=a(18957),w=a(77222),S=a(57293),R=a(36386),k=a(60995),I=a(45530),N=a(33906),L=a(44414);const M=(0,r.A)(e=>({mainContainer:{display:"flex",flexDirection:"column",position:"relative",flex:1,height:"calc(100% - 58px)",overflow:"hidden",borderRadius:0,backgroundColor:e.palette.boxlist},chatList:(0,i.A)({display:"flex",flexDirection:"column",position:"relative",flex:1,overflowY:"scroll"},e.scrollbarStyles),listItem:{cursor:"pointer"}}));function E(e){let{chats:t,handleSelectChat:a,handleDeleteChat:i,handleEditChat:r,pageInfo:o,loading:l}=e;const d=M(),c=(0,s.useHistory)(),{user:h}=(0,n.useContext)(C.c),{datetimeToClient:u}=(0,w.S)(),[m,p]=(0,n.useState)(!1),[x,g]=(0,n.useState)({}),{id:E}=(0,s.useParams)(),T=async e=>{if(O(e)>0)try{await I.A.post("/chats/".concat(e.id,"/read"),{userId:h.id})}catch(t){}E!==e.uuid&&(c.push("/chats/".concat(e.uuid)),a(e))},O=e=>e.users.find(e=>e.userId===h.id).unreads,W=e=>{const t=e.title,a=O(e);return(0,L.jsxs)(L.Fragment,{children:[t,a>0&&(0,L.jsx)(f.A,{size:"small",style:{marginLeft:5},label:a,color:"secondary"})]})},z=e=>""!==e.lastMessage?"".concat(u(e.updatedAt),": ").concat(e.lastMessage):"",D=e=>({borderLeft:e.uuid===E?"6px solid #002d6e":null,backgroundColor:e.uuid===E?"theme.palette.chatlist":null});return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(k.A,{title:N.R.t("chat.confirm.title"),open:m,onClose:p,onConfirm:()=>{i(x)},children:N.R.t("chat.confirm.message")}),(0,L.jsx)("div",{className:d.mainContainer,children:(0,L.jsx)("div",{className:d.chatList,children:(0,L.jsx)(A.A,{children:Array.isArray(t)&&t.length>0&&t.map((e,t)=>(0,L.jsxs)(b.A,{onClick:()=>T(e),className:d.listItem,style:D(e),button:!0,children:[(0,L.jsx)(j.A,{primary:W(e),secondary:z(e)}),e.ownerId===h.id&&(0,L.jsxs)(v.A,{children:[(0,L.jsx)(y.A,{onClick:()=>{T(e).then(()=>{r(e)})},edge:"end","aria-label":"delete",size:"small",style:{marginRight:5},children:(0,L.jsx)(R.A,{})}),(0,L.jsx)(y.A,{onClick:()=>{g(e),p(!0)},edge:"end","aria-label":"delete",size:"small",children:(0,L.jsx)(S.A,{})})]})]},t))})})})]})}var T=a(93363),O=a(39886),W=a(12630),z=a(57942),D=a(59428),F=a(26260);const H=(0,r.A)(e=>({mainContainer:{display:"flex",flexDirection:"column",position:"relative",flex:1,overflow:"hidden",borderRadius:0,height:"100%",borderLeft:"1px solid rgba(0, 0, 0, 0.12)"},messageList:(0,i.A)((0,i.A)({position:"relative",overflowY:"auto",height:"100%"},e.scrollbarStyles),{},{backgroundColor:e.palette.chatlist}),inputArea:{position:"relative",height:"auto"},input:{padding:"20px"},buttonSend:{margin:e.spacing(1)},boxLeft:{padding:"10px 10px 5px",margin:"10px",position:"relative",backgroundColor:"blue",maxWidth:300,borderRadius:10,borderBottomLeftRadius:0,border:"1px solid rgba(0, 0, 0, 0.12)"},boxRight:{padding:"10px 10px 5px",margin:"10px 10px 10px auto",position:"relative",backgroundColor:"green",textAlign:"right",maxWidth:300,borderRadius:10,borderBottomRightRadius:0,border:"1px solid rgba(0, 0, 0, 0.12)"}}));function B(e){let{chat:t,messages:a,handleSendMessage:i,handleLoadMore:s,scrollToBottomRef:r,pageInfo:o,loading:l}=e;const d=H(),{user:c}=(0,n.useContext)(C.c),{datetimeToClient:h}=(0,w.S)(),u=(0,n.useRef)(),[m,p]=(0,n.useState)(""),x=()=>{u.current&&u.current.scrollIntoView({})};(0,n.useEffect)(()=>{if((e=>{if(void 0!==e)return e.users.find(e=>e.userId===c.id).unreads>0;return 0})(t)>0)try{I.A.post("/chats/".concat(t.id,"/read"),{userId:c.id})}catch(e){}r.current=x},[]);return(0,L.jsxs)(g.A,{className:d.mainContainer,children:[(0,L.jsxs)("div",{onScroll:e=>{const{scrollTop:t}=e.currentTarget;o.hasMore&&!l&&t<600&&s()},className:d.messageList,children:[Array.isArray(a)&&a.map((e,t)=>e.senderId===c.id?(0,L.jsxs)(T.A,{className:d.boxRight,children:[(0,L.jsx)(O.A,{variant:"subtitle2",children:e.sender.name}),e.message,(0,L.jsx)(O.A,{variant:"caption",display:"block",children:h(e.createdAt)})]},t):(0,L.jsxs)(T.A,{className:d.boxLeft,children:[(0,L.jsx)(O.A,{variant:"subtitle2",children:e.sender.name}),e.message,(0,L.jsx)(O.A,{variant:"caption",display:"block",children:h(e.createdAt)})]},t)),(0,L.jsx)("div",{ref:u})]}),(0,L.jsx)("div",{className:d.inputArea,children:(0,L.jsx)(W.A,{variant:"outlined",fullWidth:!0,children:(0,L.jsx)(z.A,{multiline:!0,value:m,onKeyUp:e=>{"Enter"===e.key&&""!==m.trim()&&(i(m),p(""))},onChange:e=>p(e.target.value),className:d.input,endAdornment:(0,L.jsx)(D.A,{position:"end",children:(0,L.jsx)(y.A,{onClick:()=>{""!==m.trim()&&(i(m),p(""))},className:d.buttonSend,children:(0,L.jsx)(F.A,{})})})})})})]})}var U=a(95231),Y=a(23665),J=a(41397),P=a(37126);const K=(0,r.A)(e=>({mainContainer:{display:"flex",flexDirection:"column",position:"relative",flex:1,padding:e.spacing(2),height:"calc(100% - 48px)",overflowY:"hidden",border:"1px solid rgba(0, 0, 0, 0.12)"},gridContainer:{flex:1,height:"100%",border:"1px solid rgba(0, 0, 0, 0.12)",backgroundColor:e.palette.dark},gridItem:{height:"100%"},gridItemTab:{height:"92%",width:"100%"},btnContainer:{textAlign:"right",padding:10}}));function V(e){let{open:t,chat:a,type:i,handleClose:s,handleLoadNewChat:r}=e;const[p,x]=(0,n.useState)([]),[g,f]=(0,n.useState)("");(0,n.useEffect)(()=>{if(f(""),x([]),"edit"===i){const e=a.users.map(e=>({id:e.user.id,name:e.user.name}));x(e),f(a.title)}},[a,t,i]);return(0,L.jsxs)(o.A,{open:t,onClose:s,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,L.jsx)(l.A,{id:"alert-dialog-title",children:N.R.t("chat.modal.title")}),(0,L.jsx)(d.A,{children:(0,L.jsxs)(c.A,{spacing:2,container:!0,children:[(0,L.jsx)(c.A,{xs:12,style:{padding:18},item:!0,children:(0,L.jsx)(h.A,{label:N.R.t("chat.modal.titleField"),placeholder:N.R.t("chat.modal.titleField"),value:g,onChange:e=>f(e.target.value),variant:"outlined",size:"small",fullWidth:!0})}),(0,L.jsx)(c.A,{xs:12,item:!0,children:(0,L.jsx)(U.J,{onFiltered:e=>x(e),initialUsers:p})})]})}),(0,L.jsxs)(u.A,{children:[(0,L.jsx)(m.A,{onClick:s,color:"primary",children:N.R.t("chat.buttons.close")}),(0,L.jsx)(m.A,{onClick:async()=>{try{if(!g)return void alert(N.R.t("chat.toasts.fillTitle"));if(!p||0===p.length)return void alert(N.R.t("chat.toasts.fillUser"));if("edit"===i)await I.A.put("/chats/".concat(a.id),{users:p,title:g});else{const{data:e}=await I.A.post("/chats",{users:p,title:g});r(e)}s()}catch(e){}},color:"primary",variant:"contained",children:N.R.t("chat.buttons.save")})]})]})}const q=(0,P.Ay)()(function(e){const t=K(),{user:a}=(0,n.useContext)(C.c),r=(0,s.useHistory)(),[o,l]=(0,n.useState)(!1),[d,h]=(0,n.useState)("new"),[u,f]=(0,n.useState)({}),[A,b]=(0,n.useState)([]),[j,v]=(0,n.useState)({hasMore:!1}),[y,w]=(0,n.useState)([]),[S,R]=(0,n.useState)({hasMore:!1}),[k,M]=(0,n.useState)(1),[T,O]=(0,n.useState)(!1),[W,z]=(0,n.useState)(0),D=(0,n.useRef)(!0),F=(0,n.useRef)(),{id:H}=(0,s.useParams)(),U=(0,n.useContext)(Y.d);(0,n.useEffect)(()=>()=>{D.current=!1},[]),(0,n.useEffect)(()=>{D.current&&$().then(e=>{const{records:t}=e;if(t.length>0&&(b(t),v(e),H&&t.length)){const e=t.find(e=>e.uuid===H);q(e)}})},[]),(0,n.useEffect)(()=>{(0,J.isObject)(u)&&(0,J.has)(u,"id")&&X(u.id).then(()=>{"function"===typeof F.current&&setTimeout(()=>{F.current()},300)})},[u]),(0,n.useEffect)(()=>{const e=localStorage.getItem("companyId"),t=U.getSocket(e);return t.on("company-".concat(e,"-chat-user-").concat(a.id),e=>{if("create"===e.action&&b(t=>[e.record,...t]),"update"===e.action){const t=A.map(t=>t.id===e.record.id?(f(e.record),(0,i.A)({},e.record)):t);b(t)}}),t.on("company-".concat(e,"-chat"),e=>{if("delete"===e.action){const t=A.filter(t=>t.id!==+e.id);b(t),w([]),M(1),R({hasMore:!1}),f({}),r.push("/chats")}}),(0,J.isObject)(u)&&(0,J.has)(u,"id")&&t.on("company-".concat(e,"-chat-").concat(u.id),e=>{if("new-message"===e.action){w(t=>[...t,e.newMessage]);const t=A.map(t=>t.id===e.newMessage.chatId?(0,i.A)({},e.chat):t);b(t),F.current()}if("update"===e.action){const t=A.map(t=>t.id===e.chat.id?(0,i.A)({},e.chat):t);b(t),F.current()}}),()=>{t.disconnect()}},[u,U]);const q=e=>{try{w([]),M(1),f(e),z(1)}catch(t){}},G=async e=>{O(!0);try{await I.A.post("/chats/".concat(u.id,"/messages"),{message:e})}catch(t){}O(!1)},Q=async e=>{try{await I.A.delete("/chats/".concat(e.id))}catch(t){}},X=async e=>{O(!0);try{const{data:t}=await I.A.get("/chats/".concat(e,"/messages?pageNumber=").concat(k));M(e=>e+1),R(t),w(e=>[...t.records,...e])}catch(t){}O(!1)},Z=async()=>{T||X(u.id)},$=async()=>{try{const{data:e}=await I.A.get("/chats");return e}catch(e){console.log(e)}};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(V,{type:d,open:o,chat:u,handleLoadNewChat:e=>{w([]),M(1),f(e),z(1),r.push("/chats/".concat(e.uuid))},handleClose:()=>l(!1)}),(0,L.jsx)(g.A,{className:t.mainContainer,children:(0,P.o4)("md",e.width)?(0,L.jsxs)(c.A,{className:t.gridContainer,container:!0,children:[(0,L.jsxs)(c.A,{className:t.gridItem,md:3,item:!0,children:[(0,L.jsx)("div",{className:t.btnContainer,children:(0,L.jsx)(m.A,{onClick:()=>{h("new"),l(!0)},color:"primary",variant:"contained",children:N.R.t("chat.buttons.new")})}),(0,L.jsx)(E,{chats:A,pageInfo:j,loading:T,handleSelectChat:e=>q(e),handleDeleteChat:e=>Q(e),handleEditChat:()=>{h("edit"),l(!0)}})]}),(0,L.jsx)(c.A,{className:t.gridItem,md:9,item:!0,children:(0,J.isObject)(u)&&(0,J.has)(u,"id")&&(0,L.jsx)(B,{chat:u,scrollToBottomRef:F,pageInfo:S,messages:y,loading:T,handleSendMessage:G,handleLoadMore:Z})})]}):(0,L.jsxs)(c.A,{className:t.gridContainer,container:!0,children:[(0,L.jsx)(c.A,{md:12,item:!0,children:(0,L.jsxs)(p.A,{value:W,indicatorColor:"primary",textColor:"primary",onChange:(e,t)=>z(t),"aria-label":"disabled tabs example",children:[(0,L.jsx)(x.A,{label:N.R.t("chat.chats")}),(0,L.jsx)(x.A,{label:N.R.t("chat.messages")})]})}),0===W&&(0,L.jsxs)(c.A,{className:t.gridItemTab,md:12,item:!0,children:[(0,L.jsx)("div",{className:t.btnContainer,children:(0,L.jsx)(m.A,{onClick:()=>l(!0),color:"primary",variant:"contained",children:N.R.t("chat.buttons.newChat")})}),(0,L.jsx)(E,{chats:A,pageInfo:j,loading:T,handleSelectChat:e=>q(e),handleDeleteChat:e=>Q(e)})]}),1===W&&(0,L.jsx)(c.A,{className:t.gridItemTab,md:12,item:!0,children:(0,J.isObject)(u)&&(0,J.has)(u,"id")&&(0,L.jsx)(B,{scrollToBottomRef:F,pageInfo:S,messages:y,loading:T,handleSendMessage:G,handleLoadMore:Z})})]})})]})})},95231:(e,t,a)=>{a.d(t,{J:()=>m});var i=a(89379),n=a(93363),s=a(11647),r=a(32018),o=a(23386),l=a(9950),d=a(77534),c=a(45530),h=a(33906),u=a(44414);function m(e){let{onFiltered:t,initialUsers:a}=e;const[m,p]=(0,l.useState)([]),[x,g]=(0,l.useState)([]);(0,l.useEffect)(()=>{!async function(){await f()}()},[]),(0,l.useEffect)(()=>{g([]),Array.isArray(a)&&Array.isArray(m)&&m.length>0&&A(a)},[a,m]);const f=async()=>{try{const{data:e}=await c.A.get("/users/list"),t=e.map(e=>({id:e.id,name:e.name}));p(t)}catch(e){(0,d.A)(e)}},A=async e=>{g(e),t(e)};return(0,u.jsx)(n.A,{style:{padding:"0px 10px 10px"},children:(0,u.jsx)(o.Ay,{multiple:!0,size:"small",options:m,value:x,onChange:(e,t,a)=>A(t),getOptionLabel:e=>e.name,getOptionSelected:(e,t)=>(null===e||void 0===e?void 0:e.id)===(null===t||void 0===t?void 0:t.id)||(null===e||void 0===e?void 0:e.name.toLowerCase())===(null===t||void 0===t?void 0:t.name.toLowerCase()),renderTags:(e,t)=>e.map((e,a)=>(0,u.jsx)(s.A,(0,i.A)((0,i.A)({variant:"outlined",style:{backgroundColor:"#bfbfbf",textShadow:"1px 1px 1px #000",color:"white"},label:e.name},t({index:a})),{},{size:"small"}))),renderInput:e=>(0,u.jsx)(r.A,(0,i.A)((0,i.A)({},e),{},{variant:"outlined",placeholder:h.R.t("tickets.filters.user")}))})})}}}]);