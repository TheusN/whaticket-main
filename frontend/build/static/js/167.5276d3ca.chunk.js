"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[167],{64028:(e,t,a)=>{a.d(t,{A:()=>M});var n=a(89379),s=a(9950),i=a(52816),o=a(32018),r=a(18028),l=a(43510),c=a(77766),d=a(96918),u=a(40050),p=a(23386),m=a(80892),h=a(33906),x=a(45530),g=a(39456),A=a(89314),f=a(77534),j=a(69994),y=a(18957),v=a(32988),b=a(7692),k=a(39884),w=a(81788),C=a(39886),I=a(85923),R=a(44414);const S=(0,j.A)(e=>({online:{fontSize:11,color:"#25d366"},offline:{fontSize:11,color:"#e1306c"}})),T=(0,u.Z)({trim:!0}),M=e=>{let{modalOpen:t,onClose:a,initialContact:u}=e;const j=S(),[M,E]=(0,s.useState)([]),[N,P]=(0,s.useState)(!1),[O,D]=(0,s.useState)(""),[L,W]=(0,s.useState)(null),[q,F]=(0,s.useState)(""),[B,z]=(0,s.useState)(""),[H,_]=(0,s.useState)({}),[V,Y]=(0,s.useState)([]),[Q,U]=(0,s.useState)([]),[K,G]=(0,s.useState)(!1),{user:J}=(0,s.useContext)(y.c),{companyId:Z,whatsappId:X}=J,[$,ee]=(0,s.useState)(!1),[te,ae]=(0,s.useState)(""),[ne,se]=(0,s.useState)("");(0,s.useEffect)(()=>{void 0!==(null===u||void 0===u?void 0:u.id)&&(E([u]),W(u))},[u]),(0,s.useEffect)(()=>{P(!0);const e=setTimeout(()=>{null!==X&&void 0!==X&&z(X);(async()=>{if("admin"!==J.profile)return U(J.queues),void(1===J.queues.length&&F(J.queues[0].id));try{const{data:e}=await x.A.get("/queue");U(e),1===e.length&&F(e[0].id)}catch(e){(0,f.A)(h.R.t("newTicketModal.searchQueueError"))}})(),(async()=>{x.A.get("/whatsapp",{params:{companyId:Z,session:0}}).then(e=>{let{data:t}=e;return Y(t)})})(),P(!1)},500);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(!t||O.length<3)return void P(!1);P(!0);const e=setTimeout(()=>{(async()=>{try{const{data:e}=await x.A.get("contacts",{params:{searchParam:O}});E(e.contacts),P(!1)}catch(e){P(!1),(0,f.A)(e)}})()},500);return()=>clearTimeout(e)},[O,t]);const ie=()=>{a(),D(""),ee(!1),ae(""),se(""),W(null)},oe=async e=>{if(e)if(""!==q||"admin"===J.profile){P(!0);try{const t=""!==q?q:null,n=""!==B?B:null,{data:s}=await x.A.post("/tickets",{contactId:e,queueId:t,whatsappId:n,userId:J.id,status:"open"});a(s)}catch(t){console.log(t);const e=t.response.data.error;console.log(e),"ERR_OTHER_OPEN_TICKET"===e&&(0,f.A)(t),"ERR_OTHER_OPEN_TICKET"!==e&&e.userId!==(null===J||void 0===J?void 0:J.id)?(ee(!0),ae(e.user.name),se(e.queue.name)):(ee(!1),ae(""),se(""),P(!1),a(e))}P(!1)}else I.oR.error(h.R.t("newTicketModal.selectQueue"))},re=(e,t)=>{const a=T(e,t);return""!==t.inputValue&&!N&&O.length>=3&&a.push({name:"".concat(t.inputValue)}),a},le=e=>e.number?(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)(C.A,{component:"span",style:{fontSize:14,marginLeft:"10px",display:"inline-flex",alignItems:"center",lineHeight:"2"},children:[e.name," - ",e.number]})}):"".concat(h.R.t("newTicketModal.add")," ").concat(e.name),ce=e=>e.number?"".concat(e.name," - ").concat(e.number):"".concat(e.name);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(A.A,{open:K,initialValues:H,onClose:()=>{G(!1)},onSave:e=>{oe(e.id)}}),(0,R.jsxs)(r.A,{open:t,onClose:ie,children:[(0,R.jsx)(d.A,{id:"form-dialog-title",children:h.R.t("newTicketModal.title")}),(0,R.jsx)(c.A,{dividers:!0,children:(0,R.jsxs)(v.A,{style:{width:300},container:!0,spacing:2,children:[void 0===u||void 0===u.id?(0,R.jsx)(v.A,{xs:12,item:!0,children:(0,R.jsx)(p.Ay,{fullWidth:!0,options:M,loading:N,clearOnBlur:!0,autoHighlight:!0,freeSolo:!0,clearOnEscape:!0,getOptionLabel:ce,renderOption:le,filterOptions:re,onChange:(e,t)=>((e,t)=>{null!==t&&void 0!==t&&t.number?W(t):null!==t&&void 0!==t&&t.name&&(_({name:t.name}),G(!0))})(0,t),renderInput:e=>(0,R.jsx)(o.A,(0,n.A)((0,n.A)({},e),{},{label:h.R.t("newTicketModal.fieldLabel"),variant:"outlined",autoFocus:!0,onChange:e=>D(e.target.value),onKeyPress:e=>{!N&&L&&"Enter"===e.key&&oe(L.id)},InputProps:(0,n.A)((0,n.A)({},e.InputProps),{},{endAdornment:(0,R.jsxs)(s.Fragment,{children:[N?(0,R.jsx)(m.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))})}):null,(0,R.jsx)(v.A,{xs:12,item:!0,children:(0,R.jsx)(b.A,{required:!0,fullWidth:!0,displayEmpty:!0,variant:"outlined",value:q,onChange:e=>{F(e.target.value)},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},renderValue:()=>{if(""===q)return h.R.t("newTicketModal.selectQueue");return Q.find(e=>e.id===q).name},children:(null===Q||void 0===Q?void 0:Q.length)>0&&Q.map((e,t)=>(0,R.jsx)(k.A,{dense:!0,value:e.id,children:(0,R.jsx)(w.A,{primary:e.name})},t))})}),(0,R.jsx)(v.A,{xs:12,item:!0,children:(0,R.jsx)(b.A,{required:!0,fullWidth:!0,displayEmpty:!0,variant:"outlined",value:B,onChange:e=>{z(e.target.value)},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},renderValue:()=>{if(""===B)return h.R.t("newTicketModal.selectConection");return V.find(e=>e.id===B).name},children:(null===V||void 0===V?void 0:V.length)>0&&V.map((e,t)=>(0,R.jsx)(k.A,{dense:!0,value:e.id,children:(0,R.jsx)(w.A,{primary:(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)(C.A,{component:"span",style:{fontSize:14,marginLeft:"10px",display:"inline-flex",alignItems:"center",lineHeight:"2"},children:[e.name," \xa0 ",(0,R.jsxs)("p",{className:"CONNECTED"===e.status?j.online:j.offline,children:["(",e.status,")"]})]})})})},t))})})]})}),(0,R.jsxs)(l.A,{children:[(0,R.jsx)(i.A,{onClick:ie,color:"secondary",disabled:N,variant:"outlined",children:h.R.t("newTicketModal.buttons.cancel")}),(0,R.jsx)(g.A,{variant:"contained",type:"button",disabled:!L,onClick:()=>oe(L.id),color:"primary",loading:N,children:h.R.t("newTicketModal.buttons.ok")})]})]})]})}},68815:(e,t,a)=>{a.d(t,{A:()=>L});var n=a(89379),s=a(9950),i=a(29714),o=a(6443),r=a(85923),l=a(16673),c=a(69994),d=a(46493),u=a(52816),p=a(32018),m=a(18028),h=a(43510),x=a(77766),g=a(96918),A=a(80892),f=a(33906),j=a(45530),y=a(77534),v=a(12630),b=a(32988),k=a(97226),w=a(23386),C=a(59051),I=a.n(C),R=a(18957),S=a(41397),T=a(33043),M=a(80877),E=a(60995),N=a(85185),P=a(44414);const O=(0,c.A)(e=>({root:{display:"flex",flexWrap:"wrap"},multFieldLine:{display:"flex","& > *:not(:last-child)":{marginRight:e.spacing(1)}},btnWrapper:{position:"relative"},buttonProgress:{color:d.A[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12},formControl:{margin:e.spacing(1),minWidth:120}})),D=i.Ik().shape({body:i.Yj().min(5,"Mensagem muito curta").required("Obrigat\xf3rio"),contactId:i.ai().required("Obrigat\xf3rio"),sendAt:i.Yj().required("Obrigat\xf3rio")}),L=e=>{let{open:t,onClose:a,scheduleId:i,contactId:c,cleanContact:d,reload:C}=e;const L=O(),W=(0,l.useHistory)(),{user:q}=(0,s.useContext)(R.c),F={body:"",contactId:"",sendAt:I()().add(1,"hour").format("YYYY-MM-DDTHH:mm"),sentAt:""},B={id:"",name:""},[z,H]=(0,s.useState)(F),[_,V]=(0,s.useState)(B),[Y,Q]=(0,s.useState)([B]),[U,K]=(0,s.useState)(null),G=(0,s.useRef)(null),[J,Z]=(0,s.useState)(!1),X=(0,s.useRef)();(0,s.useEffect)(()=>{if(c&&Y.length){const e=Y.find(e=>e.id===c);e&&V(e)}},[c,Y]),(0,s.useEffect)(()=>{const{companyId:e}=q;if(t)try{(async()=>{const{data:t}=await j.A.get("/contacts/list",{params:{companyId:e}});let a=t.map(e=>({id:e.id,name:e.name}));if((0,S.isArray)(a)&&Q([{id:"",name:""},...a]),c&&H(e=>(0,n.A)((0,n.A)({},e),{},{contactId:c})),!i)return;const{data:s}=await j.A.get("/schedules/".concat(i));H(e=>(0,n.A)((0,n.A)((0,n.A)({},e),s),{},{sendAt:I()(s.sendAt).format("YYYY-MM-DDTHH:mm")})),V(s.contact)})()}catch(a){(0,y.A)(a)}},[i,c,t,q]);const $=()=>{a(),K(null),H(F)};return(0,P.jsxs)("div",{className:L.root,children:[(0,P.jsx)(E.A,{title:f.R.t("scheduleModal.confirmationModal.deleteTitle"),open:J,onClose:()=>Z(!1),onConfirm:async()=>{U&&(K(null),G.current.value=null),z.mediaPath&&(await j.A.delete("/schedules/".concat(z.id,"/media-upload")),H(e=>(0,n.A)((0,n.A)({},e),{},{mediaPath:null})),r.oR.success(f.R.t("scheduleModal.toasts.deleted")),"function"==typeof C&&(console.log(C),console.log("1"),C()))},children:f.R.t("scheduleModal.confirmationModal.deleteMessage")}),(0,P.jsxs)(m.A,{open:t,onClose:$,maxWidth:"xs",fullWidth:!0,scroll:"paper",children:[(0,P.jsx)(g.A,{id:"form-dialog-title",children:"ERRO"===z.status?"Erro de Envio":"Mensagem ".concat((0,S.capitalize)(z.status))}),(0,P.jsx)("div",{style:{display:"none"},children:(0,P.jsx)("input",{type:"file",accept:".png,.jpg,.jpeg",ref:G,onChange:e=>(e=>{const t=(0,S.head)(e.target.files);t&&K(t)})(e)})}),(0,P.jsx)(o.l1,{initialValues:z,enableReinitialize:!0,validationSchema:D,onSubmit:(e,t)=>{setTimeout(()=>{(async e=>{const t=(0,n.A)((0,n.A)({},e),{},{userId:q.id});try{if(i){if(await j.A.put("/schedules/".concat(i),t),null!=U){const e=new FormData;e.append("file",U),await j.A.post("/schedules/".concat(i,"/media-upload"),e)}}else{const{data:e}=await j.A.post("/schedules",t);if(null!=U){const t=new FormData;t.append("file",U),await j.A.post("/schedules/".concat(e.id,"/media-upload"),t)}}r.oR.success(f.R.t("scheduleModal.success")),"function"==typeof C&&C(),c&&"function"===typeof d&&(d(),W.push("/schedules"))}catch(a){(0,y.A)(a)}V(B),H(F),$()})(e),t.setSubmitting(!1)},400)},children:e=>{let{touched:t,errors:a,isSubmitting:s,values:r,setFieldValue:l}=e;return(0,P.jsxs)(o.lV,{children:[(0,P.jsxs)(x.A,{dividers:!0,children:[(0,P.jsx)("div",{className:L.multFieldLine,children:(0,P.jsx)(v.A,{variant:"outlined",fullWidth:!0,children:(0,P.jsx)(w.Ay,{fullWidth:!0,value:_,options:Y,onChange:(e,t)=>{const a=t?t.id:"";H((0,n.A)((0,n.A)({},z),{},{contactId:a})),V(t||B)},getOptionLabel:e=>e.name,getOptionSelected:(e,t)=>t.id===e.id,renderInput:e=>(0,P.jsx)(p.A,(0,n.A)((0,n.A)({},e),{},{variant:"outlined",placeholder:"Contato"}))})})}),(0,P.jsx)("br",{}),(0,P.jsx)("div",{className:L.multFieldLine,children:(0,P.jsx)(o.D0,{as:p.A,rows:9,multiline:!0,label:f.R.t("scheduleModal.form.body"),name:"body",inputRef:X,error:t.body&&Boolean(a.body),helperText:t.body&&a.body,variant:"outlined",margin:"dense",fullWidth:!0})}),(0,P.jsx)(b.A,{item:!0,children:(0,P.jsx)(N.A,{disabled:s,onClick:e=>(async(e,t)=>{const a=X.current,n=a.value.substring(0,a.selectionStart),s=a.value.substring(a.selectionEnd),i=a.selectionStart+e.length;t("body","".concat(n).concat(e).concat(s)),await new Promise(e=>setTimeout(e,100)),X.current.setSelectionRange(i,i)})(e,l)})}),(0,P.jsx)("br",{}),(0,P.jsx)("div",{className:L.multFieldLine,children:(0,P.jsx)(o.D0,{as:p.A,label:f.R.t("scheduleModal.form.sendAt"),type:"datetime-local",name:"sendAt",InputLabelProps:{shrink:!0},error:t.sendAt&&Boolean(a.sendAt),helperText:t.sendAt&&a.sendAt,variant:"outlined",fullWidth:!0})}),(z.mediaPath||U)&&(0,P.jsxs)(b.A,{xs:12,item:!0,children:[(0,P.jsx)(u.A,{startIcon:(0,P.jsx)(M.A,{}),children:U?U.name:z.mediaName}),(0,P.jsx)(k.A,{onClick:()=>Z(!0),color:"secondary",children:(0,P.jsx)(T.A,{color:"secondary"})})]})]}),(0,P.jsxs)(h.A,{children:[!U&&!z.mediaPath&&(0,P.jsx)(u.A,{color:"primary",onClick:()=>G.current.click(),disabled:s,variant:"outlined",children:f.R.t("quickMessages.buttons.attach")}),(0,P.jsx)(u.A,{onClick:$,color:"secondary",disabled:s,variant:"outlined",children:f.R.t("scheduleModal.buttons.cancel")}),(null===z.sentAt||""===z.sentAt)&&(0,P.jsxs)(u.A,{type:"submit",color:"primary",disabled:s,variant:"contained",className:L.btnWrapper,children:["".concat(i?f.R.t("scheduleModal.buttons.okEdit"):f.R.t("scheduleModal.buttons.okAdd")),s&&(0,P.jsx)(A.A,{size:24,className:L.buttonProgress})]})]})]})}})]})]})}},77897:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ft});var n=a(9950),s=a(37126),i=a(16673),o=a(32988),r=a(77882),l=a(69994),c=a(16714),d=a(68035),u=a(14566),p=a(87872),m=a(64028),h=a(89379),x=a(84580),g=a(10283),A=a(29206),f=a(81788),j=a(54952),y=a(55510),v=a(20906),b=a(44414);const k=()=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(A.A,{dense:!0,children:[(0,b.jsx)(j.A,{children:(0,b.jsx)(v.A,{animation:"wave",variant:"circle",width:40,height:40})}),(0,b.jsx)(f.A,{primary:(0,b.jsx)(v.A,{animation:"wave",height:20,width:60}),secondary:(0,b.jsx)(v.A,{animation:"wave",height:20,width:90})})]}),(0,b.jsx)(y.A,{variant:"inset"}),(0,b.jsxs)(A.A,{dense:!0,children:[(0,b.jsx)(j.A,{children:(0,b.jsx)(v.A,{animation:"wave",variant:"circle",width:40,height:40})}),(0,b.jsx)(f.A,{primary:(0,b.jsx)(v.A,{animation:"wave",height:20,width:70}),secondary:(0,b.jsx)(v.A,{animation:"wave",height:20,width:120})})]}),(0,b.jsx)(y.A,{variant:"inset"}),(0,b.jsxs)(A.A,{dense:!0,children:[(0,b.jsx)(j.A,{children:(0,b.jsx)(v.A,{animation:"wave",variant:"circle",width:40,height:40})}),(0,b.jsx)(f.A,{primary:(0,b.jsx)(v.A,{animation:"wave",height:20,width:60}),secondary:(0,b.jsx)(v.A,{animation:"wave",height:20,width:90})})]}),(0,b.jsx)(y.A,{variant:"inset"})]});var w=a(69279),C=a(33906),I=a(18957),R=a(23665);const S=(0,l.A)(e=>({ticketsListWrapper:{position:"relative",display:"flex",height:"100%",flexDirection:"column",overflow:"hidden",borderTopRightRadius:0,borderBottomRightRadius:0},ticketsList:(0,h.A)((0,h.A)({flex:1,maxHeight:"100%",overflowY:"scroll"},e.scrollbarStyles),{},{borderTop:"2px solid rgba(0, 0, 0, 0.12)"}),ticketsListHeader:{color:"rgb(67, 83, 105)",zIndex:2,backgroundColor:"white",borderBottom:"1px solid rgba(0, 0, 0, 0.12)",display:"flex",alignItems:"center",justifyContent:"space-between"},ticketsCount:{fontWeight:"normal",color:"rgb(104, 121, 146)",marginLeft:"8px",fontSize:"14px"},noTicketsText:{textAlign:"center",color:"rgb(104, 121, 146)",fontSize:"14px",lineHeight:"1.4"},noTicketsTitle:{textAlign:"center",fontSize:"16px",fontWeight:"600",margin:"0px"},noTicketsDiv:{display:"flex",height:"100px",margin:40,flexDirection:"column",alignItems:"center",justifyContent:"center"}})),T=(e,t)=>{if("LOAD_TICKETS"===t.type){return t.payload.forEach(t=>{const a=e.findIndex(e=>e.id===t.id);-1!==a?(e[a]=t,t.unreadMessages>0&&e.unshift(e.splice(a,1)[0])):e.push(t)}),[...e]}if("RESET_UNREAD"===t.type){const a=t.payload,n=e.findIndex(e=>e.id===a);return-1!==n&&(e[n].unreadMessages=0),[...e]}if("UPDATE_TICKET"===t.type){const a=t.payload,n=e.findIndex(e=>e.id===a.id);return-1!==n?e[n]=a:e.unshift(a),[...e]}if("UPDATE_TICKET_UNREAD_MESSAGES"===t.type){const a=t.payload,n=e.findIndex(e=>e.id===a.id);return-1!==n?(e[n]=a,e.unshift(e.splice(n,1)[0])):e.unshift(a),[...e]}if("UPDATE_TICKET_CONTACT"===t.type){const a=t.payload,n=e.findIndex(e=>e.contactId===a.id);return-1!==n&&(e[n].contact=a),[...e]}if("DELETE_TICKET"===t.type){const a=t.payload,n=e.findIndex(e=>e.id===a);return-1!==n&&e.splice(n,1),[...e]}if("RESET"===t.type)return[]},M=e=>{const{status:t,searchParam:a,tags:s,users:i,showAll:o,selectedQueueIds:l,updateCount:c,style:d}=e,u=S(),[p,m]=(0,n.useState)(1),[h,A]=(0,n.useReducer)(T,[]),{user:f}=(0,n.useContext)(I.c),{profile:j,queues:y}=f,v=(0,n.useContext)(R.d);(0,n.useEffect)(()=>{A({type:"RESET"}),m(1)},[t,a,A,o,s,i,l]);const{tickets:M,hasMore:E,loading:N}=(0,w.A)({pageNumber:p,searchParam:a,status:t,showAll:o,tags:JSON.stringify(s),users:JSON.stringify(i),queueIds:JSON.stringify(l)});(0,n.useEffect)(()=>{const e=y.map(e=>e.id),t=M.filter(t=>e.indexOf(t.queueId)>-1);A("user"===j?{type:"LOAD_TICKETS",payload:t}:{type:"LOAD_TICKETS",payload:M})},[M,t,a,y,j]),(0,n.useEffect)(()=>{const e=localStorage.getItem("companyId"),a=v.getSocket(e),n=e=>(!e.userId||e.userId===(null===f||void 0===f?void 0:f.id)||o)&&(!e.queueId||l.indexOf(e.queueId)>-1);return a.on("ready",()=>{t?a.emit("joinTickets",t):a.emit("joinNotification")}),a.on("company-".concat(e,"-ticket"),e=>{var a;"updateUnread"===e.action&&A({type:"RESET_UNREAD",payload:e.ticketId}),"update"===e.action&&n(e.ticket)&&e.ticket.status===t&&A({type:"UPDATE_TICKET",payload:e.ticket}),"update"===e.action&&((a=e.ticket).queueId&&-1===l.indexOf(a.queueId))&&A({type:"DELETE_TICKET",payload:e.ticket.id}),"delete"===e.action&&A({type:"DELETE_TICKET",payload:e.ticketId})}),a.on("company-".concat(e,"-appMessage"),e=>{var a,s;const i=y.map(e=>e.id);("user"!==j||-1!==i.indexOf(null===(a=e.ticket)||void 0===a||null===(s=a.queue)||void 0===s?void 0:s.id)&&null!==e.ticket.queue)&&("create"!==e.action||!n(e.ticket)||void 0!==t&&e.ticket.status!==t||A({type:"UPDATE_TICKET_UNREAD_MESSAGES",payload:e.ticket}))}),a.on("company-".concat(e,"-contact"),e=>{"update"===e.action&&A({type:"UPDATE_TICKET_CONTACT",payload:e.contact})}),()=>{a.disconnect()}},[t,o,f,l,s,i,j,y,v]),(0,n.useEffect)(()=>{"function"===typeof c&&c(h.length)},[h]);return(0,b.jsx)(r.A,{className:u.ticketsListWrapper,style:d,children:(0,b.jsx)(r.A,{square:!0,name:"closed",elevation:0,className:u.ticketsList,onScroll:e=>{if(!E||N)return;const{scrollTop:t,scrollHeight:a,clientHeight:n}=e.currentTarget;a-(t+100)<n&&m(e=>e+1)},children:(0,b.jsxs)(x.A,{style:{paddingTop:0},children:[0!==h.length||N?(0,b.jsx)(b.Fragment,{children:h.map(e=>(0,b.jsx)(g.A,{ticket:e},e.id))}):(0,b.jsxs)("div",{className:u.noTicketsDiv,children:[(0,b.jsx)("span",{className:u.noTicketsTitle,children:C.R.t("ticketsList.noTicketsTitle")}),(0,b.jsx)("p",{className:u.noTicketsText,children:C.R.t("ticketsList.noTicketsMessage")})]}),N&&(0,b.jsx)(k,{})]})})})};var E=a(52776),N=a(39884),P=a(12630),O=a(7692),D=a(95535);const L=e=>{let{userQueues:t,selectedQueueIds:a=[],onChange:n}=e;return(0,b.jsx)("div",{style:{width:120,marginTop:-4},children:(0,b.jsx)(P.A,{fullWidth:!0,margin:"dense",children:(0,b.jsx)(O.A,{multiple:!0,displayEmpty:!0,variant:"outlined",value:a,onChange:e=>{n(e.target.value)},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},renderValue:()=>C.R.t("ticketsQueueSelect.placeholder"),children:(null===t||void 0===t?void 0:t.length)>0&&t.map(e=>(0,b.jsxs)(N.A,{dense:!0,value:e.id,children:[(0,b.jsx)(D.A,{style:{color:e.color},size:"small",color:"primary",checked:a.indexOf(e.id)>-1}),(0,b.jsx)(f.A,{primary:e.name})]},e.id))})})})};var W=a(52816),q=a(93363),F=a(11647),B=a(32018),z=a(23386),H=a(77534),_=a(45530);function V(e){let{onFiltered:t}=e;const[a,s]=(0,n.useState)([]),[i,o]=(0,n.useState)([]);(0,n.useEffect)(()=>{!async function(){await r()}()},[]);const r=async()=>{try{const{data:e}=await _.A.get("/tags/list");s(e)}catch(e){(0,H.A)(e)}};return(0,b.jsx)(q.A,{style:{padding:10},children:(0,b.jsx)(z.Ay,{multiple:!0,size:"small",options:a,value:i,onChange:(e,a,n)=>(async e=>{o(e),t(e)})(a),getOptionLabel:e=>e.name,renderTags:(e,t)=>e.map((e,a)=>(0,b.jsx)(F.A,(0,h.A)((0,h.A)({variant:"outlined",style:{backgroundColor:e.color||"#eee",textShadow:"1px 1px 1px #000",color:"white"},label:e.name},t({index:a})),{},{size:"small"}))),renderInput:e=>(0,b.jsx)(B.A,(0,h.A)((0,h.A)({},e),{},{variant:"outlined",placeholder:C.R.t("tickets.filters.tags")}))})})}var Y=a(95231),Q=a(66181);const U=(0,l.A)(e=>({ticketsWrapper:{position:"relative",display:"flex",height:"100%",flexDirection:"column",overflow:"hidden",borderTopRightRadius:0,borderBottomRightRadius:0,borderRadius:0},tabsHeader:{flex:"none",backgroundColor:e.palette.tabHeaderBackground},tabsInternal:{flex:"none",backgroundColor:e.palette.tabHeaderBackground},settingsIcon:{alignSelf:"center",marginLeft:"auto",padding:8},tab:{minWidth:120,width:120},internalTab:{minWidth:120,width:120,padding:5},ticketOptionsBox:{display:"flex",justifyContent:"space-between",alignItems:"center",background:e.palette.optionsBackground,padding:e.spacing(1)},ticketSearchLine:{padding:e.spacing(1)},serachInputWrapper:{flex:1,background:e.palette.total,display:"flex",borderRadius:40,padding:4,marginRight:e.spacing(1)},searchIcon:{color:"grey",marginLeft:6,marginRight:6,alignSelf:"center"},searchInput:{flex:1,border:"none",borderRadius:30},insiderTabPanel:{height:"100%",marginTop:"-72px",paddingTop:"72px"},insiderDoubleTabPanel:{display:"flex",flexDirection:"column",marginTop:"-72px",paddingTop:"72px",height:"100%"},labelContainer:{width:"auto",padding:0},iconLabelWrapper:{flexDirection:"row","& > *:first-child":{marginBottom:"3px !important",marginRight:16}},insiderTabLabel:{[e.breakpoints.down(1600)]:{display:"none"}},smallFormControl:{"& .MuiOutlinedInput-input":{padding:"12px 10px"},"& .MuiInputLabel-outlined":{marginTop:"-6px"}}})),K=()=>{const e=U(),t=(0,i.useHistory)(),[a,s]=(0,n.useState)(""),[o,l]=(0,n.useState)(!1),[h,x]=(0,n.useState)(!1),g=(0,n.useRef)(),{user:A}=(0,n.useContext)(I.c),{profile:f}=A,[j,y]=(0,n.useState)(0),[v,k]=(0,n.useState)(0),w=A.queues.map(e=>e.id),[R,S]=(0,n.useState)(w||[]),[T,N]=(0,n.useState)([]),[P,O]=(0,n.useState)([]),{ticketFilter:D,ticketSubFilter:q,searchParam:F,setSearchParam:B}=(0,Q.BP)();let z;(0,n.useEffect)(()=>{"ADMIN"===A.profile.toUpperCase()&&x(!0)},[]),(0,n.useEffect)(()=>{"search"===D&&g.current&&g.current.focus()},[D]);const H=e=>{const t=e.target.value.toLowerCase();clearTimeout(z),s(t),z=setTimeout(()=>{B(t)},500)},_=e=>{if(q!==e)return{width:0,height:0}},K=e=>{const t=e.map(e=>e.id);N(t)},G=e=>{const t=e.map(e=>e.id);O(t)};return(0,b.jsxs)(r.A,{elevation:0,variant:"outlined",className:e.ticketsWrapper,children:[(0,b.jsx)(m.A,{modalOpen:o,onClose:e=>{(e=>{l(!1),void 0!==e&&void 0!==e.uuid&&t.push("/tickets/".concat(e.uuid))})(e)}}),"search"===D?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(r.A,{square:!0,elevation:0,className:e.ticketOptionsBox,children:[(0,b.jsxs)("div",{className:e.serachInputWrapper,children:[(0,b.jsx)(c.A,{className:e.searchIcon}),(0,b.jsx)(d.A,{className:e.searchInput,inputRef:g,placeholder:C.R.t("tickets.search.placeholder"),type:"search",value:a,onChange:H})]}),(0,b.jsx)(L,{style:{marginLeft:6},selectedQueueIds:R,userQueues:null===A||void 0===A?void 0:A.queues,onChange:e=>S(e)})]}),(0,b.jsx)(V,{onFiltered:K}),"admin"===f&&(0,b.jsx)(Y.J,{onFiltered:G}),(0,b.jsx)(M,{searchParam:F,showAll:!0,tags:T,users:P,selectedQueueIds:R})]}):"closed"===D?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(r.A,{square:!0,elevation:0,className:e.ticketOptionsBox,children:[(0,b.jsx)(W.A,{variant:"outlined",color:"primary",onClick:()=>l(!0),children:C.R.t("ticketsManager.buttons.newTicket")}),(0,b.jsx)(L,{style:{marginLeft:6},selectedQueueIds:R,userQueues:null===A||void 0===A?void 0:A.queues,onChange:e=>S(e)})]}),(0,b.jsx)(M,{status:"closed",showAll:!0,selectedQueueIds:R})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(r.A,{square:!0,elevation:0,className:e.ticketOptionsBox,children:[(0,b.jsx)(W.A,{variant:"outlined",color:"primary",onClick:()=>l(!0),children:C.R.t("ticketsManager.buttons.newTicket")}),(0,b.jsx)(E.T,{role:A.profile,perform:"tickets-manager:showall",yes:()=>(0,b.jsx)(u.A,{label:C.R.t("tickets.buttons.showAll"),labelPlacement:"start",control:(0,b.jsx)(p.A,{size:"small",checked:h,onChange:()=>x(e=>!e),name:"showAllTickets",color:"primary"})})}),(0,b.jsx)(L,{style:{marginLeft:6},selectedQueueIds:R,userQueues:null===A||void 0===A?void 0:A.queues,onChange:e=>S(e)})]}),(0,b.jsxs)(r.A,{className:e.ticketsWrapper,children:[(0,b.jsx)(M,{status:"open",showAll:h,selectedQueueIds:R,updateCount:e=>y(e),style:_("open")}),(0,b.jsx)(M,{status:"pending",selectedQueueIds:R,updateCount:e=>k(e),style:_("pending")})]})]})]})};var G=a(85923),J=a(2803),Z=a(39886),X=a(97226),$=a(13144),ee=a(63371),te=a(92284),ae=a(57513),ne=a(73094),se=a(96374);const ie=e=>{let{classes:t}=e;return(0,b.jsxs)("div",{className:t.content,children:[(0,b.jsx)(r.A,{square:!0,variant:"outlined",className:t.contactHeader,children:(0,b.jsxs)(o.A,{container:!0,children:[(0,b.jsx)(o.A,{item:!0,children:(0,b.jsx)(v.A,{animation:"wave",variant:"circle",width:60,height:60,className:t.contactAvatar})}),(0,b.jsxs)(o.A,{item:!0,children:[(0,b.jsx)(v.A,{animation:"wave",height:25,width:90}),(0,b.jsx)(v.A,{animation:"wave",height:25,width:80}),(0,b.jsx)(v.A,{animation:"wave",height:25,width:80})]})]})}),(0,b.jsxs)(r.A,{square:!0,className:t.contactDetails,children:[(0,b.jsx)(Z.A,{variant:"subtitle1",children:C.R.t("contactDrawer.extraInfo")}),(0,b.jsxs)(r.A,{square:!0,variant:"outlined",className:t.contactExtraInfo,children:[(0,b.jsx)(v.A,{animation:"wave",height:20,width:60}),(0,b.jsx)(v.A,{animation:"wave",height:20,width:160})]}),(0,b.jsxs)(r.A,{square:!0,variant:"outlined",className:t.contactExtraInfo,children:[(0,b.jsx)(v.A,{animation:"wave",height:20,width:60}),(0,b.jsx)(v.A,{animation:"wave",height:20,width:160})]}),(0,b.jsxs)(r.A,{square:!0,variant:"outlined",className:t.contactExtraInfo,children:[(0,b.jsx)(v.A,{animation:"wave",height:20,width:60}),(0,b.jsx)(v.A,{animation:"wave",height:20,width:160})]})]})]})};var oe=a(24241),re=a(45406),le=a(29714),ce=a(6443),de=a(46493),ue=a(80892);const pe=(0,l.A)(e=>({root:{display:"flex",flexWrap:"wrap"},textField:{marginRight:e.spacing(1),flex:1},extraAttr:{display:"flex",justifyContent:"center",alignItems:"center"},btnWrapper:{position:"relative"},buttonProgress:{color:de.A[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12},textCenter:{backgroundColor:"red"}})),me=le.Ik().shape({name:le.Yj().min(2,"Too Short!").max(50,"Too Long!").required("Required"),number:le.Yj().min(8,"Too Short!").max(50,"Too Long!"),email:le.Yj().email("Invalid email")});function he(e){let{initialContact:t,onSave:a,onCancel:s}=e;const i=pe(),[r,l]=(0,n.useState)(t);(0,n.useEffect)(()=>{l(t)},[t]);return(0,b.jsx)(ce.l1,{initialValues:r,enableReinitialize:!0,validationSchema:me,onSubmit:(e,t)=>{setTimeout(()=>{(async e=>{try{if(r.id)await _.A.put("/contacts/".concat(r.id),e);else{const{data:t}=await _.A.post("/contacts",e);a&&a(t)}G.oR.success(C.R.t("contactModal.success"))}catch(t){(0,H.A)(t)}})(e),t.setSubmitting(!1)},400)},children:e=>{let{values:t,errors:a,touched:n,isSubmitting:l}=e;return(0,b.jsx)(ce.lV,{children:(0,b.jsxs)(o.A,{container:!0,spacing:1,children:[(0,b.jsx)(o.A,{item:!0,xs:12,children:(0,b.jsx)(ce.D0,{as:B.A,label:C.R.t("contactModal.form.name"),name:"name",autoFocus:!0,error:n.name&&Boolean(a.name),helperText:n.name&&a.name,variant:"outlined",margin:"dense",className:i.textField,fullWidth:!0})}),(0,b.jsx)(o.A,{item:!0,xs:12,children:(0,b.jsx)(ce.D0,{as:B.A,label:C.R.t("contactModal.form.number"),name:"number",error:n.number&&Boolean(a.number),helperText:n.number&&a.number,placeholder:"5513912344321",variant:"outlined",margin:"dense",fullWidth:!0})}),(0,b.jsx)(o.A,{item:!0,xs:12,children:(0,b.jsx)(ce.D0,{as:B.A,label:C.R.t("contactModal.form.email"),name:"email",error:n.email&&Boolean(a.email),helperText:n.email&&a.email,placeholder:"Email address",fullWidth:!0,margin:"dense",variant:"outlined"})}),(0,b.jsx)(o.A,{item:!0,xs:12,spacing:1,children:(0,b.jsxs)(o.A,{container:!0,spacing:1,children:[(0,b.jsx)(o.A,{xs:6,item:!0,children:(0,b.jsx)(W.A,{onClick:s,color:"secondary",disabled:l,variant:"outlined",fullWidth:!0,children:C.R.t("contactModal.buttons.cancel")})}),(0,b.jsx)(o.A,{classes:i.textCenter,xs:6,item:!0,children:(0,b.jsxs)(W.A,{type:"submit",color:"primary",disabled:l,variant:"contained",className:i.btnWrapper,fullWidth:!0,children:[r.id?"".concat(C.R.t("contactModal.buttons.okEdit")):"".concat(C.R.t("contactModal.buttons.okAdd")),l&&(0,b.jsx)(ue.A,{size:24,className:i.buttonProgress})]})})]})})]})})}})}var xe=a(89314),ge=a(3546),Ae=a(57293),fe=a(59051),je=a.n(fe);const ye=(0,l.A)(e=>({inline:{width:"100%"}}));function ve(e){const{note:t,deleteItem:a}=e,n=ye();return(0,b.jsxs)(A.A,{alignItems:"flex-start",children:[(0,b.jsx)(j.A,{children:(0,b.jsx)(ne.A,{alt:t.user.name,src:"/static/images/avatar/1.jpg"})}),(0,b.jsx)(f.A,{primary:(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(Z.A,{component:"span",variant:"body2",className:n.inline,color:"textPrimary",children:t.note})}),secondary:(0,b.jsxs)(b.Fragment,{children:[t.user.name,", ",je()(t.createdAt).format("DD/MM/YY HH:mm")]})}),(0,b.jsx)(ge.A,{children:(0,b.jsx)(X.A,{onClick:()=>{a(t)},edge:"end","aria-label":"delete",children:(0,b.jsx)(Ae.A,{})})})]})}var be=a(60995),ke=a(39456);const we=()=>({saveNote:async e=>{const{data:t}=await _.A.request({url:"/ticket-notes",method:"POST",data:e});return t},deleteNote:async e=>{const{data:t}=await _.A.request({url:"/ticket-notes/".concat(e),method:"DELETE"});return t},listNotes:async e=>{const{data:t}=await _.A.request({url:"/ticket-notes/list",method:"GET",params:e});return t}}),Ce=(0,l.A)(e=>({root:{"& .MuiTextField-root":{margin:e.spacing(1),width:"350px"}},list:{width:"100%",maxWidth:"350px",maxHeight:"200px",backgroundColor:e.palette.background.paper,overflow:"auto"},inline:{width:"100%"}})),Ie=le.Ik().shape({note:le.Yj().min(2,"Too Short!").required("Required")});function Re(e){let{ticket:t}=e;const{id:a,contactId:s}=t,i=Ce(),[r,l]=(0,n.useState)({note:""}),[c,d]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),[m,g]=(0,n.useState)({}),[A,f]=(0,n.useState)([]),{saveNote:j,deleteNote:y,listNotes:v}=we();(0,n.useEffect)(()=>{!async function(){k(),await R()}()},[]);const k=()=>{l({note:""}),d(!1)},w=e=>{l({note:e.target.value})},I=e=>{g(e),p(!0)},R=async()=>{d(!0);try{const e=await v({ticketId:a,contactId:s});f(e)}catch(e){G.oR.error(e)}d(!1)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(be.A,{title:"Excluir Registro",open:u,onClose:p,onConfirm:async()=>{d(!0);try{await y(m.id),await R(),g({}),G.oR.success("Observa\xe7\xe3o exclu\xedda com sucesso!")}catch(e){G.oR.error(e)}d(!1)},children:"Deseja realmente excluir este registro?"}),(0,b.jsx)(ce.l1,{initialValues:r,enableReinitialize:!0,validationSchema:Ie,onSubmit:(e,t)=>{setTimeout(()=>{(async e=>{d(!0);try{await j((0,h.A)((0,h.A)({},e),{},{ticketId:a,contactId:s})),await R(),l({note:""}),G.oR.success("Observa\xe7\xe3o adicionada com sucesso!")}catch(t){G.oR.error(t)}d(!1)})(e),t.setSubmitting(!1)},400)},children:e=>{let{touched:t,errors:a,setErrors:n}=e;return(0,b.jsx)(ce.lV,{children:(0,b.jsxs)(o.A,{container:!0,spacing:2,children:[(0,b.jsx)(o.A,{xs:12,item:!0,children:(0,b.jsx)(ce.D0,{as:B.A,name:"note",rows:3,label:C.R.t("ticketOptionsMenu.appointmentsModal.textarea"),placeholder:C.R.t("ticketOptionsMenu.appointmentsModal.placeholder"),multiline:!0,error:t.note&&Boolean(a.note),helperText:t.note&&a.note,variant:"outlined",onChange:w,fullWidth:!0})}),A.length>0&&(0,b.jsx)(o.A,{xs:12,item:!0,children:(0,b.jsx)(x.A,{className:i.list,children:A.map(e=>(0,b.jsx)(ve,{note:e,deleteItem:I},e.id))})}),(0,b.jsx)(o.A,{xs:12,item:!0,children:(0,b.jsxs)(o.A,{container:!0,spacing:2,children:[(0,b.jsx)(o.A,{xs:6,item:!0,children:(0,b.jsx)(W.A,{onClick:()=>{l(""),n({})},color:"primary",variant:"outlined",fullWidth:!0,children:"Cancelar"})}),(0,b.jsx)(o.A,{xs:6,item:!0,children:(0,b.jsx)(ke.A,{loading:c,color:"primary",type:"submit",variant:"contained",autoFocus:!0,fullWidth:!0,children:"Salvar"})})]})})]})})}})]})}const Se=(0,l.A)(e=>({drawer:{width:320,flexShrink:0},drawerPaper:{width:320,display:"flex",borderTop:"1px solid rgba(0, 0, 0, 0.12)",borderRight:"1px solid rgba(0, 0, 0, 0.12)",borderBottom:"1px solid rgba(0, 0, 0, 0.12)",borderTopRightRadius:4,borderBottomRightRadius:4},header:{display:"flex",borderBottom:"1px solid rgba(0, 0, 0, 0.12)",backgroundColor:e.palette.contactdrawer,alignItems:"center",padding:e.spacing(0,1),minHeight:"73px",justifyContent:"flex-start"},content:(0,h.A)({display:"flex",backgroundColor:e.palette.contactdrawer,flexDirection:"column",padding:"8px 0px 8px 8px",height:"100%",overflowY:"scroll"},e.scrollbarStyles),contactAvatar:{margin:15,width:100,height:100},contactHeader:{display:"flex",padding:8,flexDirection:"column",alignItems:"center",justifyContent:"center","& > *":{margin:4}},contactDetails:{marginTop:8,padding:8,display:"flex",flexDirection:"column"},contactExtraInfo:{marginTop:4,padding:6}})),Te=e=>{var t;let{open:a,handleDrawerClose:s,contact:i,ticket:o,loading:l}=e;const c=Se(),[d,u]=(0,n.useState)(!1),[p,m]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{m(!1)},[a,i]),(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(ee.Ay,{className:c.drawer,variant:"persistent",anchor:"right",open:a,PaperProps:{style:{position:"absolute"}},BackdropProps:{style:{position:"absolute"}},ModalProps:{container:document.getElementById("drawer-container"),style:{position:"absolute"}},classes:{paper:c.drawerPaper},children:[(0,b.jsxs)("div",{className:c.header,children:[(0,b.jsx)(X.A,{onClick:s,children:(0,b.jsx)($.A,{})}),(0,b.jsx)(Z.A,{style:{justifySelf:"center"},children:C.R.t("contactDrawer.header")})]}),l?(0,b.jsx)(ie,{classes:c}):(0,b.jsxs)("div",{className:c.content,children:[(0,b.jsxs)(r.A,{square:!0,variant:"outlined",className:c.contactHeader,children:[(0,b.jsx)(re.A,{onClick:()=>{},style:{cursor:"pointer",width:"100%"},titleTypographyProps:{noWrap:!0},subheaderTypographyProps:{noWrap:!0},avatar:(0,b.jsx)(ne.A,{src:i.profilePicUrl,alt:"contact_image",style:{width:60,height:60}}),title:(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(Z.A,{onClick:()=>m(!0),children:[i.name,(0,b.jsx)(se.A,{style:{fontSize:16,marginLeft:5}})]})}),subheader:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Z.A,{style:{fontSize:12},children:(0,b.jsx)(te.A,{href:"tel:".concat(i.number),children:i.number})}),(0,b.jsx)(Z.A,{style:{fontSize:12},children:(0,b.jsx)(te.A,{href:"mailto:".concat(i.email),children:i.email})})]})}),(0,b.jsx)(W.A,{variant:"outlined",color:"primary",onClick:()=>u(!p),style:{fontSize:12},children:C.R.t("contactDrawer.buttons.edit")}),i.id&&p&&(0,b.jsx)(he,{initialContact:i,onCancel:()=>m(!1)})]}),(0,b.jsxs)(r.A,{square:!0,variant:"outlined",className:c.contactDetails,children:[(0,b.jsx)(Z.A,{variant:"subtitle1",style:{marginBottom:10},children:C.R.t("ticketOptionsMenu.appointmentsModal.title")}),(0,b.jsx)(Re,{ticket:o})]}),(0,b.jsxs)(r.A,{square:!0,variant:"outlined",className:c.contactDetails,children:[(0,b.jsx)(xe.A,{open:d,onClose:()=>u(!1),contactId:i.id}),(0,b.jsx)(Z.A,{variant:"subtitle1",children:C.R.t("contactDrawer.extraInfo")}),null===i||void 0===i||null===(t=i.extraInfo)||void 0===t?void 0:t.map(e=>(0,b.jsxs)(r.A,{square:!0,variant:"outlined",className:c.contactExtraInfo,children:[(0,b.jsx)(ae.A,{children:e.name}),(0,b.jsx)(Z.A,{component:"div",noWrap:!0,style:{paddingTop:2},children:(0,b.jsx)(oe.A,{children:e.value})})]},e.id))]})]})]})})};var Me=a(80045),Ee=(a(32415),a(62773)),Ne=a(61273),Pe=a.n(Ne),Oe=a(41397),De=a(80877),Le=a(31753),We=a(26260),qe=a(13608),Fe=a(94157),Be=a(62895),ze=a(69976),He=a(54435),_e=a(26910);const Ve=(0,l.A)(e=>({timerBox:{display:"flex",marginLeft:10,marginRight:10,alignItems:"center"}})),Ye=()=>{const e=Ve(),[t,a]=(0,n.useState)({minutes:0,seconds:0});(0,n.useEffect)(()=>{const e=setInterval(()=>a(e=>59===e.seconds?(0,h.A)((0,h.A)({},e),{},{minutes:e.minutes+1,seconds:0}):(0,h.A)((0,h.A)({},e),{},{seconds:e.seconds+1})),1e3);return()=>{clearInterval(e)}},[]);const s=e=>e<10?"0"+e:e;return(0,b.jsx)("div",{className:e.timerBox,children:(0,b.jsx)("span",{children:"".concat(s(t.minutes),":").concat(s(t.seconds))})})};var Qe=a(27259);const Ue=()=>({save:async e=>{const{data:t}=await _.A.request({url:"/quick-messages",method:"POST",data:e});return t},update:async e=>{const{data:t}=await _.A.request({url:"/quick-messages/".concat(e.id),method:"PUT",data:e});return t},deleteRecord:async e=>{const{data:t}=await _.A.request({url:"/quick-messages/".concat(e),method:"DELETE"});return t},list:async e=>{const{data:t}=await _.A.request({url:"/quick-messages/list",method:"GET",params:e});return t}}),Ke=["InputLabelProps","InputProps"],Ge=new(Pe())({bitRate:128}),Je=(0,l.A)(e=>({mainWrapper:{backgroundColor:e.palette.bordabox,display:"flex",flexDirection:"column",alignItems:"center",borderTop:"1px solid rgba(0, 0, 0, 0.12)"},newMessageBox:{backgroundColor:e.palette.newmessagebox,width:"100%",display:"flex",padding:"7px",alignItems:"center"},messageInputWrapper:{padding:6,marginRight:7,backgroundColor:e.palette.inputdigita,display:"flex",borderRadius:20,flex:1},messageInput:{paddingLeft:10,flex:1,border:"none"},sendMessageIcons:{color:"grey"},uploadInput:{display:"none"},viewMediaInputWrapper:{display:"flex",padding:"10px 13px",position:"relative",justifyContent:"space-between",alignItems:"center",backgroundColor:"#eee",borderTop:"1px solid rgba(0, 0, 0, 0.12)"},emojiBox:{position:"absolute",bottom:63,width:40,borderTop:"1px solid #e8e8e8"},circleLoading:{color:de.A[500],opacity:"70%",position:"absolute",top:"20%",left:"50%",marginLeft:-12},audioLoading:{color:de.A[500],opacity:"70%"},recorderWrapper:{display:"flex",alignItems:"center",alignContent:"middle"},cancelAudioIcon:{color:"red"},sendAudioIcon:{color:"green"},replyginMsgWrapper:{display:"flex",width:"100%",alignItems:"center",justifyContent:"center",paddingTop:8,paddingLeft:73,paddingRight:7},replyginMsgContainer:{flex:1,marginRight:5,overflowY:"hidden",backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:"7.5px",display:"flex",position:"relative"},replyginMsgBody:{padding:10,height:"auto",display:"block",whiteSpace:"pre-wrap",overflow:"hidden"},replyginContactMsgSideColor:{flex:"none",width:"4px",backgroundColor:"#35cd96"},replyginSelfMsgSideColor:{flex:"none",width:"4px",backgroundColor:"#6bcbef"},messageContactName:{display:"flex",color:"#6bcbef",fontWeight:500}})),Ze=e=>{const{disabled:t,showEmoji:a,setShowEmoji:n,handleAddEmoji:s}=e,i=Je();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(X.A,{"aria-label":"emojiPicker",component:"span",disabled:t,onClick:e=>n(e=>!e),children:(0,b.jsx)(Le.A,{className:i.sendMessageIcons})}),a?(0,b.jsx)("div",{className:i.emojiBox,children:(0,b.jsx)(Ee.LC,{perLine:16,showPreview:!1,showSkinTones:!1,onSelect:s})}):null]})},Xe=e=>{const{width:t,setSignMessage:a,signMessage:n}=e;return(0,s.o4)("md",t)?(0,b.jsx)(u.A,{style:{marginRight:7,color:"gray"},label:C.R.t("messagesInput.signMessage"),labelPlacement:"start",control:(0,b.jsx)(p.A,{size:"small",checked:n,onChange:e=>{a(e.target.checked)},name:"showAllTickets",color:"primary"})}):null},$e=e=>{const{handleChangeMedias:t,disableOption:a}=e,n=Je();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{multiple:!0,type:"file",id:"upload-button",disabled:a(),className:n.uploadInput,onChange:t}),(0,b.jsx)("label",{htmlFor:"upload-button",children:(0,b.jsx)(X.A,{"aria-label":"upload",component:"span",disabled:a(),children:(0,b.jsx)(De.A,{className:n.sendMessageIcons})})})]})},et=e=>{const{inputMessage:t,loading:a,recording:n,ticketStatus:s,handleSendMessage:i,handleCancelAudio:o,handleUploadAudio:r,handleStartRecording:l}=e,c=Je();return t?(0,b.jsx)(X.A,{"aria-label":"sendMessage",component:"span",onClick:i,disabled:a,children:(0,b.jsx)(We.A,{className:c.sendMessageIcons})}):n?(0,b.jsxs)("div",{className:c.recorderWrapper,children:[(0,b.jsx)(X.A,{"aria-label":"cancelRecording",component:"span",fontSize:"large",disabled:a,onClick:o,children:(0,b.jsx)(He.A,{className:c.cancelAudioIcon})}),a?(0,b.jsx)("div",{children:(0,b.jsx)(ue.A,{className:c.audioLoading})}):(0,b.jsx)(Ye,{}),(0,b.jsx)(X.A,{"aria-label":"sendRecordedAudio",component:"span",onClick:r,disabled:a,children:(0,b.jsx)(ze.A,{className:c.sendAudioIcon})})]}):(0,b.jsx)(X.A,{"aria-label":"showRecorder",component:"span",disabled:a||"open"!==s,onClick:l,children:(0,b.jsx)(Be.A,{className:c.sendMessageIcons})})},tt=e=>{const{loading:t,inputRef:a,ticketStatus:s,inputMessage:i,setInputMessage:o,handleSendMessage:r,handleInputPaste:l,disableOption:c,handleQuickAnswersClick:u}=e,p=Je(),[m,x]=(0,n.useState)([]),[g,A]=(0,n.useState)([]),[f,j]=(0,n.useState)(!1),{user:y}=(0,n.useContext)(I.c),{list:v}=Ue();(0,n.useEffect)(()=>{!async function(){const e=localStorage.getItem("companyId"),t=(await v({companyId:e,userId:y.id})).map(e=>{let t=e.message;return(0,Oe.isString)(t)&&t.length>35&&(t=e.message.substring(0,35)+"..."),{value:e.message,label:"/".concat(e.shortcode," - ").concat(t),mediaPath:e.mediaPath}});x(t)}()},[]),(0,n.useEffect)(()=>{if((0,Oe.isString)(i)&&!(0,Oe.isEmpty)(i)&&i.length>1){const e=i.charAt(0);j(e.indexOf("/")>-1);const t=m.filter(e=>e.label.indexOf(i)>-1);A(t)}else j(!1)},[i]);const k=e=>{e&&(e.focus(),a.current=e)};return(0,b.jsx)("div",{className:p.messageInputWrapper,children:(0,b.jsx)(z.Ay,{freeSolo:!0,open:f,id:"grouped-demo",value:i,options:g,closeIcon:null,getOptionLabel:e=>(0,Oe.isObject)(e)?e.label:e,onChange:(e,t)=>{(0,Oe.isObject)(t)&&(0,Oe.has)(t,"value")&&(0,Oe.isNil)(t.mediaPath)?(o(t.value),setTimeout(()=>{a.current.scrollTop=a.current.scrollHeight},200)):(0,Oe.isObject)(t)&&(0,Oe.has)(t,"value")&&!(0,Oe.isNil)(t.mediaPath)&&(u(t),setTimeout(()=>{a.current.scrollTop=a.current.scrollHeight},200))},onInputChange:(e,t,a)=>{"input"===a&&o(e.target.value)},onPaste:e=>{"open"===s&&l(e)},onKeyPress:e=>{t||e.shiftKey||"Enter"===e.key&&r()},style:{width:"100%"},renderInput:e=>{const{InputLabelProps:t,InputProps:a}=e,n=(0,Me.A)(e,Ke);return(0,b.jsx)(d.A,(0,h.A)((0,h.A)((0,h.A)({},e.InputProps),n),{},{disabled:c(),inputRef:k,placeholder:"open"===s?C.R.t("messagesInput.placeholderOpen"):C.R.t("messagesInput.placeholderClosed"),multiline:!0,className:p.messageInput,maxRows:5}))}})})},at=(0,s.Ay)()(e=>{var t;const{ticketStatus:a,ticketId:s}=e,i=Je(),[o,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(""),[u,p]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),[x,g]=(0,n.useState)(!1),A=(0,n.useRef)(),{setReplyingMessage:f,replyingMessage:j}=(0,n.useContext)(Qe.t),{user:y}=(0,n.useContext)(I.c),[v,k]=function(e,t){const[a,s]=(0,n.useState)(()=>{try{const a=localStorage.getItem(e);return a?JSON.parse(a):t}catch(a){return(0,H.A)(a),t}});return[a,t=>{try{const n=t instanceof Function?t(a):t;s(n),localStorage.setItem(e,JSON.stringify(n))}catch(n){(0,H.A)(n)}}]}("signOption",!0);(0,n.useEffect)(()=>{A.current.focus()},[j]),(0,n.useEffect)(()=>(A.current.focus(),()=>{d(""),p(!1),l([]),f(null)}),[s,f]);const w=e=>{let t=e.native;d(e=>e+t)},C=e=>{if(!e.target.files)return;const t=Array.from(e.target.files);l(t)},R=e=>{e.clipboardData.files[0]&&l([e.clipboardData.files[0]])},S=async e=>{if(e.mediaPath)try{const{data:t}=await _e.A.get(e.mediaPath,{responseType:"blob"});return(async(e,t)=>{h(!0);try{const a=e.type.split("/")[1],n=new FormData,i="".concat((new Date).getTime(),".").concat(a);n.append("medias",e,i),n.append("body",t),n.append("fromMe",!0),await _.A.post("/messages/".concat(s),n)}catch(a){(0,H.A)(a),h(!1)}h(!1)})(t,e.value),void d("")}catch(t){(0,H.A)(t)}d(""),d(e.value)},T=async()=>{if(""===c.trim())return;h(!0);const e={read:1,fromMe:!0,mediaUrl:"",body:v?"*".concat(null===y||void 0===y?void 0:y.name,":*\n").concat(c.trim()):c.trim(),quotedMsg:j};try{await _.A.post("/messages/".concat(s),e)}catch(t){(0,H.A)(t)}d(""),p(!1),h(!1),f(null)},M=async()=>{h(!0);try{await navigator.mediaDevices.getUserMedia({audio:!0}),await Ge.start(),g(!0),h(!1)}catch(e){(0,H.A)(e),h(!1)}},E=async()=>{h(!0);try{const[,e]=await Ge.stop().getMp3();if(e.size<1e4)return h(!1),void g(!1);const t=new FormData,a="audio-record-site-".concat((new Date).getTime(),".mp3");t.append("medias",e,a),t.append("body",a),t.append("fromMe",!0),await _.A.post("/messages/".concat(s),t)}catch(e){(0,H.A)(e)}g(!1),h(!1)},N=async()=>{try{await Ge.stop().getMp3(),g(!1)}catch(e){(0,H.A)(e)}},P=()=>m||x||"open"!==a,O=e=>{var t;return(0,b.jsxs)("div",{className:i.replyginMsgWrapper,children:[(0,b.jsxs)("div",{className:i.replyginMsgContainer,children:[(0,b.jsx)("span",{className:(0,J.A)(i.replyginContactMsgSideColor,{[i.replyginSelfMsgSideColor]:!e.fromMe})}),(0,b.jsxs)("div",{className:i.replyginMsgBody,children:[!e.fromMe&&(0,b.jsx)("span",{className:i.messageContactName,children:null===(t=e.contact)||void 0===t?void 0:t.name}),e.body]})]}),(0,b.jsx)(X.A,{"aria-label":"showRecorder",component:"span",disabled:m||"open"!==a,onClick:()=>f(null),children:(0,b.jsx)(Fe.A,{className:i.sendMessageIcons})})]})};return o.length>0?(0,b.jsxs)(r.A,{elevation:0,square:!0,className:i.viewMediaInputWrapper,children:[(0,b.jsx)(X.A,{"aria-label":"cancel-upload",component:"span",onClick:e=>l([]),children:(0,b.jsx)(qe.A,{className:i.sendMessageIcons})}),m?(0,b.jsx)("div",{children:(0,b.jsx)(ue.A,{className:i.circleLoading})}):(0,b.jsx)("span",{children:null===(t=o[0])||void 0===t?void 0:t.name}),(0,b.jsx)(X.A,{"aria-label":"send-upload",component:"span",onClick:async e=>{h(!0),e.preventDefault();const t=new FormData;t.append("fromMe",!0),o.forEach(e=>{t.append("medias",e),t.append("body",e.name)});try{await _.A.post("/messages/".concat(s),t)}catch(a){(0,H.A)(a)}h(!1),l([])},disabled:m,children:(0,b.jsx)(We.A,{className:i.sendMessageIcons})})]}):(0,b.jsxs)(r.A,{square:!0,elevation:0,className:i.mainWrapper,children:[j&&O(j),(0,b.jsxs)("div",{className:i.newMessageBox,children:[(0,b.jsx)(Ze,{disabled:P(),handleAddEmoji:w,showEmoji:u,setShowEmoji:p}),(0,b.jsx)($e,{disableOption:P,handleChangeMedias:C}),(0,b.jsx)(Xe,{width:e.width,setSignMessage:k,signMessage:v}),(0,b.jsx)(tt,{loading:m,inputRef:A,ticketStatus:a,inputMessage:c,setInputMessage:d,handleSendMessage:T,handleInputPaste:R,disableOption:P,handleQuickAnswersClick:S}),(0,b.jsx)(et,{inputMessage:c,loading:m,recording:x,ticketStatus:a,handleSendMessage:T,handleCancelAudio:N,handleUploadAudio:E,handleStartRecording:M})]})]})});var nt=a(80305),st=a(16035),it=a(65113),ot=a(38604),rt=a(94087),lt=a(18028),ct=a(43510),dt=a(77766),ut=a(96918),pt=a(40050);const mt=()=>({findAll:async()=>{const{data:e}=await _.A.get("/queue");return e}}),ht=(0,l.A)(e=>({maxWidth:{width:"100%"}})),xt=(0,pt.Z)({trim:!0}),gt=e=>{let{modalOpen:t,onClose:a,ticketid:s}=e;const r=(0,i.useHistory)(),[l,c]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[p,m]=(0,n.useState)([]),[x,g]=(0,n.useState)(!1),[A,j]=(0,n.useState)(""),[y,v]=(0,n.useState)(null),[k,w]=(0,n.useState)(""),R=ht(),{findAll:S}=mt(),T=(0,n.useRef)(!0),[M,E]=(0,n.useState)([]),[D,L]=(0,n.useState)(""),{user:q}=(0,n.useContext)(I.c),{companyId:F,whatsappId:V}=q;(0,n.useEffect)(()=>()=>{T.current=!1},[]),(0,n.useEffect)(()=>{g(!0);const e=setTimeout(()=>{null!==V&&void 0!==V&&L(V),1===q.queues.length&&w(q.queues[0].id),(async()=>{_.A.get("/whatsapp",{params:{companyId:F,session:0}}).then(e=>{let{data:t}=e;return E(t)})})(),g(!1)},500);return()=>clearTimeout(e)},[]),(0,n.useEffect)(()=>{if(T.current){(async()=>{const e=await S();m(e),u(e)})()}},[]),(0,n.useEffect)(()=>{if(!t||A.length<3)return void g(!1);const e=setTimeout(()=>{g(!0);(async()=>{try{const{data:e}=await _.A.get("/users/",{params:{searchParam:A}});c(e.users),g(!1)}catch(e){g(!1),(0,H.A)(e)}})()},500);return()=>clearTimeout(e)},[A,t]);const Y=()=>{a(),j(""),v(null)};return(0,b.jsx)(lt.A,{open:t,onClose:Y,maxWidth:"lg",scroll:"paper",children:(0,b.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),s&&k&&""!==k){g(!0);try{let e={};y&&(e.userId=y.id),k&&null!==k&&(e.queueId=k,y||(e.status="pending",e.userId=null)),D&&(e.whatsappId=D),await _.A.put("/tickets/".concat(s),e),r.push("/tickets")}catch(t){g(!1),(0,H.A)(t)}}},children:[(0,b.jsx)(ut.A,{id:"form-dialog-title",children:C.R.t("transferTicketModal.title")}),(0,b.jsxs)(dt.A,{dividers:!0,children:[(0,b.jsx)(z.Ay,{style:{width:300,marginBottom:20},getOptionLabel:e=>"".concat(e.name),onChange:(e,t)=>{v(t),null!=t&&Array.isArray(t.queues)?u(t.queues):(u(p),w(""))},options:l,filterOptions:xt,freeSolo:!0,autoHighlight:!0,noOptionsText:C.R.t("transferTicketModal.noOptions"),loading:x,renderInput:e=>(0,b.jsx)(B.A,(0,h.A)((0,h.A)({},e),{},{label:C.R.t("transferTicketModal.fieldLabel"),variant:"outlined",autoFocus:!0,onChange:e=>j(e.target.value),InputProps:(0,h.A)((0,h.A)({},e.InputProps),{},{endAdornment:(0,b.jsxs)(n.Fragment,{children:[x?(0,b.jsx)(ue.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}),(0,b.jsxs)(P.A,{variant:"outlined",className:R.maxWidth,children:[(0,b.jsx)(ae.A,{children:C.R.t("transferTicketModal.fieldQueueLabel")}),(0,b.jsx)(O.A,{value:k,onChange:e=>w(e.target.value),label:C.R.t("transferTicketModal.fieldQueuePlaceholder"),children:d.map(e=>(0,b.jsx)(N.A,{value:e.id,children:e.name},e.id))})]}),(0,b.jsx)(o.A,{container:!0,spacing:2,style:{marginTop:"15px"},children:(0,b.jsx)(o.A,{xs:12,item:!0,children:(0,b.jsx)(O.A,{required:!0,fullWidth:!0,displayEmpty:!0,variant:"outlined",value:D,onChange:e=>{L(e.target.value)},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},renderValue:()=>{if(""===D)return"Selecione uma Conex\xe3o";return M.find(e=>e.id===D).name},children:(null===M||void 0===M?void 0:M.length)>0&&M.map((e,t)=>(0,b.jsx)(N.A,{dense:!0,value:e.id,children:(0,b.jsx)(f.A,{primary:(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(Z.A,{component:"span",style:{fontSize:14,marginLeft:"10px",display:"inline-flex",alignItems:"center",lineHeight:"2"},children:[e.name," \xa0 ",(0,b.jsxs)("p",{className:"CONNECTED"===e.status?R.online:R.offline,children:["(",e.status,")"]})]})})})},t))})})})]}),(0,b.jsxs)(ct.A,{children:[(0,b.jsx)(W.A,{onClick:Y,color:"secondary",disabled:x,variant:"outlined",children:C.R.t("transferTicketModal.buttons.cancel")}),(0,b.jsx)(ke.A,{variant:"contained",type:"submit",color:"primary",loading:x,children:C.R.t("transferTicketModal.buttons.ok")})]})]})})};var At=a(68815);const ft=e=>{let{ticket:t,menuOpen:a,handleClose:s,anchorEl:i}=e;const[o,r]=(0,n.useState)(!1),[l,c]=(0,n.useState)(!1),d=(0,n.useRef)(!0),{user:u}=(0,n.useContext)(I.c),[p,m]=(0,n.useState)(!1),[h,x]=(0,n.useState)(null);(0,n.useEffect)(()=>()=>{d.current=!1},[]);const g=e=>{r(!0),s()};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(rt.A,{id:"menu-appbar",anchorEl:i,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:a,onClose:s,children:[(0,b.jsx)(N.A,{onClick:()=>{s(),x(t.contact.id),m(!0)},children:C.R.t("ticketOptionsMenu.schedule")}),(0,b.jsx)(N.A,{onClick:e=>{c(!0),s()},children:C.R.t("ticketOptionsMenu.transfer")}),(0,b.jsx)(E.T,{role:u.profile,perform:"ticket-options:deleteTicket",yes:()=>(0,b.jsx)(N.A,{onClick:g,children:C.R.t("ticketOptionsMenu.delete")})})]}),(0,b.jsx)(be.A,{title:"".concat(C.R.t("ticketOptionsMenu.confirmationModal.title")).concat(t.id," ").concat(C.R.t("ticketOptionsMenu.confirmationModal.titleFrom")," ").concat(t.contact.name,"?"),open:o,onClose:r,onConfirm:async()=>{try{await _.A.delete("/tickets/".concat(t.id))}catch(e){(0,H.A)(e)}},children:C.R.t("ticketOptionsMenu.confirmationModal.message")}),(0,b.jsx)(gt,{modalOpen:l,onClose:()=>{d.current&&c(!1)},ticketid:t.id}),(0,b.jsx)(At.A,{open:p,onClose:()=>{m(!1),x(null)},"aria-labelledby":"form-dialog-title",contactId:h})]})};var jt=a(42207),yt=a(80684),vt=a(81603),bt=a(58006);const kt=(0,l.A)(e=>({actionButtons:{marginRight:6,flex:"none",alignSelf:"center",marginLeft:"auto",display:"flex",gap:e.spacing(.5),"& > *":{margin:e.spacing(.5)}},resolveButton:{color:e.palette.success.main,"&:hover":{backgroundColor:"dark"===e.mode?"rgba(16, 185, 129, 0.08)":"rgba(16, 185, 129, 0.12)"}},returnButton:{color:e.palette.warning.main,"&:hover":{backgroundColor:"dark"===e.mode?"rgba(245, 158, 11, 0.08)":"rgba(245, 158, 11, 0.12)"}}})),wt=e=>{let{ticket:t}=e;const a=kt(),s=(0,i.useHistory)(),[o,r]=(0,n.useState)(null),[l,c]=(0,n.useState)(!1),d=Boolean(o),{user:u}=(0,n.useContext)(I.c),{setCurrentTicket:p}=(0,n.useContext)(jt.B),m=async(e,a,n)=>{c(!0);try{await _.A.put("/tickets/".concat(t.id),{status:a,userId:n||null,useIntegration:"closed"!==a&&t.useIntegration,promptId:"closed"!==a&&t.promptId,integrationId:"closed"!==a&&t.integrationId}),c(!1),"open"===a?p((0,h.A)((0,h.A)({},t),{},{code:"#open"})):(p({id:null,code:null}),s.push("/tickets"))}catch(i){c(!1),(0,H.A)(i)}};return(0,b.jsxs)("div",{className:a.actionButtons,children:["closed"===t.status&&(0,b.jsx)(ke.A,{loading:l,startIcon:(0,b.jsx)(it.A,{}),size:"small",onClick:e=>m(0,"open",null===u||void 0===u?void 0:u.id),children:C.R.t("messagesList.header.buttons.reopen")}),"open"===t.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(bt.Ay,{title:C.R.t("messagesList.header.buttons.return"),children:(0,b.jsx)(X.A,{onClick:e=>m(0,"pending",null),className:a.returnButton,children:(0,b.jsx)(vt.A,{})})}),(0,b.jsx)(bt.Ay,{title:C.R.t("messagesList.header.buttons.resolve"),children:(0,b.jsx)(X.A,{onClick:e=>m(0,"closed",null===u||void 0===u?void 0:u.id),className:a.resolveButton,children:(0,b.jsx)(yt.A,{})})}),(0,b.jsx)(X.A,{onClick:e=>{r(e.currentTarget)},children:(0,b.jsx)(ot.A,{})}),(0,b.jsx)(ft,{ticket:t,anchorEl:o,menuOpen:d,handleClose:e=>{r(null)}})]}),"pending"===t.status&&(0,b.jsx)(ke.A,{loading:l,size:"small",variant:"contained",color:"primary",onClick:e=>m(0,"open",null===u||void 0===u?void 0:u.id),children:C.R.t("messagesList.header.buttons.accept")})]})};var Ct=a(89546);function It(e){let{ticket:t}=e;const[a,s]=(0,n.useState)([]),[i,o]=(0,n.useState)([]),l=(0,n.useRef)(!0);(0,n.useEffect)(()=>()=>{l.current=!1},[]),(0,n.useEffect)(()=>{l.current&&d().then(()=>{Array.isArray(t.tags)?o(t.tags):o([])})},[t]);const c=async e=>{try{const{data:t}=await _.A.post("/tags",e);return t}catch(t){(0,H.A)(t)}},d=async()=>{try{const{data:e}=await _.A.get("/tags/list");s(e)}catch(e){(0,H.A)(e)}},u=async(e,a)=>{let n=[];if("create-option"===a){if((0,Oe.isArray)(e))for(let t of e)if((0,Oe.isString)(t)){const e=await c({name:t});n.push(e)}else n.push(t);await d()}else n=e;o(n),await(async e=>{try{const{data:t}=await _.A.post("/tags/sync",e);return t}catch(t){(0,H.A)(t)}})({ticketId:t.id,tags:n})};return(0,b.jsx)(r.A,{style:{padding:12},children:(0,b.jsx)(z.Ay,{multiple:!0,size:"small",options:a,value:i,freeSolo:!0,onChange:(e,t,a)=>u(t,a),getOptionLabel:e=>e.name,renderTags:(e,t)=>e.map((e,a)=>(0,b.jsx)(F.A,(0,h.A)((0,h.A)({variant:"outlined",style:{background:e.color||"#eee",color:"#FFF",marginRight:1,fontWeight:600,borderRadius:3,fontSize:"0.8em",whiteSpace:"nowrap"},label:e.name.toUpperCase()},t({index:a})),{},{size:"small"}))),renderInput:e=>(0,b.jsx)(B.A,(0,h.A)((0,h.A)({},e),{},{variant:"outlined",placeholder:"Tags"})),PaperComponent:e=>{let{children:t}=e;return(0,b.jsx)(r.A,{style:{width:400,marginLeft:12},children:t})}})})}const Rt=(0,l.A)(e=>({root:{display:"flex",height:"100%",position:"relative",overflow:"hidden"},mainWrapper:{flex:1,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"0",marginRight:-320,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},mainWrapperShift:{borderTopRightRadius:0,borderBottomRightRadius:0,transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0}})),St=()=>{const{ticketId:e}=(0,i.useParams)(),t=(0,i.useHistory)(),a=Rt(),{user:s}=(0,n.useContext)(I.c),[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!0),[u,p]=(0,n.useState)({}),[m,x]=(0,n.useState)({}),g=(0,n.useContext)(R.d);(0,n.useEffect)(()=>{d(!0);const a=setTimeout(()=>{(async()=>{try{const{data:a}=await _.A.get("/tickets/u/"+e),{queueId:n}=a,{queues:i,profile:o}=s;if(void 0===i.find(e=>e.id===n)&&"admin"!==o)return G.oR.error(C.R.t("tickets.toasts.unauthorized")),void t.push("/tickets");p(a.contact),x(a),d(!1)}catch(a){d(!1),(0,H.A)(a)}})()},500);return()=>clearTimeout(a)},[e,s,t]),(0,n.useEffect)(()=>{const e=localStorage.getItem("companyId"),a=g.getSocket(e);return a.on("ready",()=>a.emit("joinChatBox","".concat(m.id))),a.on("company-".concat(e,"-ticket"),e=>{"update"===e.action&&e.ticket.id===m.id&&x(e.ticket),"delete"===e.action&&e.ticketId===m.id&&t.push("/tickets")}),a.on("company-".concat(e,"-contact"),e=>{"update"===e.action&&p(t=>{var a;return t.id===(null===(a=e.contact)||void 0===a?void 0:a.id)?(0,h.A)((0,h.A)({},t),e.contact):t})}),()=>{a.disconnect()}},[e,m,t,g]);const A=()=>{l(!0)};return(0,b.jsxs)("div",{className:a.root,id:"drawer-container",children:[(0,b.jsxs)(r.A,{variant:"outlined",elevation:0,className:(0,J.A)(a.mainWrapper,{[a.mainWrapperShift]:o}),children:[(0,b.jsxs)(nt.A,{loading:c,children:[(()=>{if(void 0!==m.user)return(0,b.jsx)(st.A,{contact:u,ticket:m,onClick:A})})(),(0,b.jsx)(wt,{ticket:m})]}),(0,b.jsx)(r.A,{children:(0,b.jsx)(It,{ticket:m})}),(0,b.jsx)(Qe.T,{children:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Ct.A,{ticket:m,ticketId:m.id,isGroup:m.isGroup}),(0,b.jsx)(at,{ticketId:m.id,ticketStatus:m.status})]})})]}),(0,b.jsx)(Te,{open:o,handleDrawerClose:()=>{l(!1)},contact:u,loading:c,ticket:m})]})};var Tt=a(33153);const Mt=(0,l.A)(e=>({chatContainer:{flex:1,padding:e.spacing(1),height:"calc(100% - 48px)",overflowY:"hidden"},chatPapper:{display:"flex",height:"100%"},contactsWrapper:{display:"flex",height:"100%",flexDirection:"column",overflowY:"hidden"},messagesWrapper:{display:"flex",height:"100%",flexDirection:"column"},welcomeMsg:{backgroundColor:e.palette.boxticket,display:"flex",justifyContent:"space-evenly",alignItems:"center",height:"100%",textAlign:"center"}})),Et=()=>{const e=Mt(),{ticketId:t}=(0,i.useParams)();return(0,b.jsx)("div",{className:e.chatContainer,children:(0,b.jsx)("div",{className:e.chatPapper,children:(0,b.jsxs)(o.A,{container:!0,spacing:0,children:[(0,b.jsx)(o.A,{item:!0,xs:4,className:e.contactsWrapper,children:(0,b.jsx)(K,{})}),(0,b.jsx)(o.A,{item:!0,xs:8,className:e.messagesWrapper,children:t?(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(St,{})}):(0,b.jsx)(r.A,{square:!0,variant:"outlined",className:e.welcomeMsg,children:(0,b.jsx)("div",{children:(0,b.jsx)("center",{children:(0,b.jsx)("img",{style:{margin:"0 auto",width:"70%"},src:Tt,alt:"logologin"})})})})})]})})})};var Nt=a(99690),Pt=a(43486),Ot=a(19404),Dt=a(2888);const Lt=(0,a(68945).A)(r.A)({height:"calc(100% - 48px)",display:"grid",gridTemplateRows:"56px 1fr"}),Wt=(0,l.A)(e=>({header:{},content:{overflow:"auto"},placeholderContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",backgroundColor:e.palette.boxticket},placeholderItem:{}})),qt=e=>{const t=Wt(),{ticketId:a}=(0,i.useParams)(),[s,o]=(0,n.useState)(0),{currentTicket:r,setCurrentTicket:l}=(0,n.useContext)(jt.B);(0,n.useEffect)(()=>(null!==r.id&&l({id:r.id,code:"#open"}),a||o(1),()=>{l({id:null,code:null})}),[]),(0,n.useEffect)(()=>{null!==r.id&&o(0)},[r]);return(0,b.jsxs)(Lt,{children:[(0,b.jsx)(q.A,{className:t.header,children:(0,b.jsxs)(Nt.A,{value:s,onChange:(e,t)=>{o(t)},showLabels:!0,className:t.root,children:[(0,b.jsx)(Pt.A,{label:C.R.t("ticketAdvanced.ticketNav"),icon:(0,b.jsx)(Dt.A,{})}),(0,b.jsx)(Pt.A,{label:C.R.t("ticketAdvanced.attendanceNav"),icon:(0,b.jsx)(Ot.A,{})})]})}),(0,b.jsx)(q.A,{className:t.content,children:0===s?a?(0,b.jsx)(St,{}):(0,b.jsxs)(q.A,{className:t.placeholderContainer,children:["//PLW DESIGN LOGO//",(0,b.jsx)("div",{children:(0,b.jsx)("center",{children:(0,b.jsx)("img",{style:{margin:"0 auto",width:"70%"},src:Tt,alt:"logologin"})})}),"//PLW DESIGN LOGO//",(0,b.jsx)("br",{}),(0,b.jsx)(W.A,{onClick:()=>o(1),variant:"contained",color:"primary",children:C.R.t("ticketAdvanced.selectTicket")})]}):(0,b.jsx)(K,{})})]})};const Ft=(0,s.Ay)()(function(e){return(0,s.o4)("md",e.width)?(0,b.jsx)(Et,{}):(0,b.jsx)(qt,{})})},85185:(e,t,a)=>{a.d(t,{A:()=>x});a(9950);var n=a(69994),s=a(11647),i=a(33906),o=a(89379),r=a(80045),l=a(32018),c=a(44414);const d=["inputRef"],u=["InputProps","children","InputLabelProps","label"],p=e=>{let{inputRef:t}=e,a=(0,r.A)(e,d);return(0,c.jsx)("div",(0,o.A)({},a))},m=e=>{let{InputProps:t,children:a,InputLabelProps:n,label:s}=e,i=(0,r.A)(e,u);return(0,c.jsx)(l.A,(0,o.A)((0,o.A)({},i),{},{variant:"outlined",label:s,multiline:!0,InputLabelProps:(0,o.A)({shrink:!0},n),InputProps:(0,o.A)({inputComponent:p},t),inputProps:{children:a}}))},h=(0,n.A)(e=>({chip:{margin:e.spacing(.5),cursor:"pointer"}})),x=e=>{let{onClick:t,disabled:a}=e;const n=h(),o=[{name:i.R.t("messageVariablesPicker.vars.contactFirstName"),value:"{{firstName}}"},{name:i.R.t("messageVariablesPicker.vars.contactName"),value:"{{name}} "},{name:i.R.t("messageVariablesPicker.vars.greeting"),value:"{{ms}} "},{name:i.R.t("messageVariablesPicker.vars.protocolNumber"),value:"{{protocol}} "},{name:i.R.t("messageVariablesPicker.vars.hour"),value:"{{hora}} "}];return(0,c.jsx)(m,{margin:"dense",fullWidth:!0,label:i.R.t("messageVariablesPicker.label"),disabled:a,children:o.map(e=>(0,c.jsx)(s.A,{onMouseDown:n=>((e,n)=>{e.preventDefault(),a||t(n)})(n,e.value),label:e.name,size:"small",className:n.chip,color:"primary"},e.value))})}},89314:(e,t,a)=>{a.d(t,{A:()=>I});var n=a(89379),s=a(9950),i=a(29714),o=a(6443),r=a(85923),l=a(69994),c=a(46493),d=a(52816),u=a(32018),p=a(18028),m=a(43510),h=a(77766),x=a(96918),g=a(39886),A=a(97226),f=a(33043),j=a(80892),y=a(33906),v=a(45530),b=a(77534),k=(a(85494),a(44414));const w=(0,l.A)(e=>({root:{display:"flex",flexWrap:"wrap"},textField:{marginRight:e.spacing(1),flex:1},extraAttr:{display:"flex",justifyContent:"center",alignItems:"center"},btnWrapper:{position:"relative"},buttonProgress:{color:c.A[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}})),C=i.Ik().shape({name:i.Yj().min(2,y.R.t("contactModal.formErrors.name.short")).max(50,y.R.t("contactModal.formErrors.name.long")).required(y.R.t("contactModal.formErrors.name.required")),number:i.Yj().min(8,y.R.t("contactModal.formErrors.phone.short")).max(50,y.R.t("contactModal.formErrors.phone.long")),email:i.Yj().email(y.R.t("contactModal.formErrors.email.invalid"))}),I=e=>{let{open:t,onClose:a,contactId:i,initialValues:l,onSave:c}=e;const I=w(),R=(0,s.useRef)(!0),S={name:"",number:"",email:""},[T,M]=(0,s.useState)(S);(0,s.useEffect)(()=>()=>{R.current=!1},[]),(0,s.useEffect)(()=>{(async()=>{if(l&&M(e=>(0,n.A)((0,n.A)({},e),l)),i)try{const{data:e}=await v.A.get("/contacts/".concat(i));R.current&&(console.log(e),M((0,n.A)((0,n.A)({},e),{},{number:e.number})))}catch(e){(0,b.A)(e)}})()},[i,t,l]);const E=()=>{a(),M(S)};return(0,k.jsx)("div",{className:I.root,children:(0,k.jsxs)(p.A,{open:t,onClose:E,maxWidth:"lg",scroll:"paper",children:[(0,k.jsx)(x.A,{id:"form-dialog-title",children:"".concat(i?y.R.t("contactModal.title.edit"):y.R.t("contactModal.title.add"))}),(0,k.jsx)(o.l1,{initialValues:T,enableReinitialize:!0,validationSchema:C,onSubmit:(e,t)=>{setTimeout(()=>{(async e=>{try{if(i)await v.A.put("/contacts/".concat(i),e),E();else{const{data:t}=await v.A.post("/contacts",e);c&&c(t),E()}r.oR.success(y.R.t("contactModal.success"))}catch(t){(0,b.A)(t)}})(e),t.setSubmitting(!1)},400)},children:e=>{let{values:t,errors:a,touched:n,isSubmitting:s}=e;return(0,k.jsxs)(o.lV,{children:[(0,k.jsxs)(h.A,{dividers:!0,children:[(0,k.jsx)(g.A,{variant:"subtitle1",gutterBottom:!0,children:y.R.t("contactModal.form.mainInfo")}),(0,k.jsx)(o.D0,{as:u.A,label:y.R.t("contactModal.form.name"),name:"name",autoFocus:!0,error:n.name&&Boolean(a.name),helperText:n.name&&a.name,variant:"outlined",margin:"dense",className:I.textField}),(0,k.jsx)(o.D0,{as:u.A,name:"number",label:y.R.t("contactModal.form.number"),error:n.number&&Boolean(a.number),helperText:n.number&&a.number,placeholder:"",variant:"outlined",margin:"dense"}),(0,k.jsx)("div",{children:(0,k.jsx)(o.D0,{as:u.A,label:y.R.t("contactModal.form.email"),name:"email",error:n.email&&Boolean(a.email),helperText:n.email&&a.email,placeholder:"Email address",fullWidth:!0,margin:"dense",variant:"outlined"})}),(0,k.jsxs)(g.A,{style:{marginBottom:8,marginTop:12},variant:"subtitle1",children:[y.R.t("contactModal.form.whatsapp")," ",null!==T&&void 0!==T&&T.whatsapp?null===T||void 0===T?void 0:T.whatsapp.name:""]}),(0,k.jsx)(g.A,{style:{marginBottom:8,marginTop:12},variant:"subtitle1",children:y.R.t("contactModal.form.extraInfo")}),(0,k.jsx)(o.ED,{name:"extraInfo",children:e=>{let{push:a,remove:n}=e;return(0,k.jsxs)(k.Fragment,{children:[t.extraInfo&&t.extraInfo.length>0&&t.extraInfo.map((e,t)=>(0,k.jsxs)("div",{className:I.extraAttr,children:[(0,k.jsx)(o.D0,{as:u.A,label:y.R.t("contactModal.form.extraName"),name:"extraInfo[".concat(t,"].name"),variant:"outlined",margin:"dense",className:I.textField}),(0,k.jsx)(o.D0,{as:u.A,label:y.R.t("contactModal.form.extraValue"),name:"extraInfo[".concat(t,"].value"),variant:"outlined",margin:"dense",className:I.textField}),(0,k.jsx)(A.A,{size:"small",onClick:()=>n(t),children:(0,k.jsx)(f.A,{})})]},"".concat(t,"-info"))),(0,k.jsx)("div",{className:I.extraAttr,children:(0,k.jsx)(d.A,{style:{flex:1,marginTop:8},variant:"outlined",color:"primary",onClick:()=>a({name:"",value:""}),children:"+ ".concat(y.R.t("contactModal.buttons.addExtraInfo"))})})]})}})]}),(0,k.jsxs)(m.A,{children:[(0,k.jsx)(d.A,{onClick:E,color:"secondary",disabled:s,variant:"outlined",children:y.R.t("contactModal.buttons.cancel")}),(0,k.jsxs)(d.A,{type:"submit",color:"primary",disabled:s,variant:"contained",className:I.btnWrapper,children:["".concat(i?y.R.t("contactModal.buttons.okEdit"):y.R.t("contactModal.buttons.okAdd")),s&&(0,k.jsx)(j.A,{size:24,className:I.buttonProgress})]})]})]})}})]})})}},95231:(e,t,a)=>{a.d(t,{J:()=>m});var n=a(89379),s=a(93363),i=a(11647),o=a(32018),r=a(23386),l=a(9950),c=a(77534),d=a(45530),u=a(33906),p=a(44414);function m(e){let{onFiltered:t,initialUsers:a}=e;const[m,h]=(0,l.useState)([]),[x,g]=(0,l.useState)([]);(0,l.useEffect)(()=>{!async function(){await A()}()},[]),(0,l.useEffect)(()=>{g([]),Array.isArray(a)&&Array.isArray(m)&&m.length>0&&f(a)},[a,m]);const A=async()=>{try{const{data:e}=await d.A.get("/users/list"),t=e.map(e=>({id:e.id,name:e.name}));h(t)}catch(e){(0,c.A)(e)}},f=async e=>{g(e),t(e)};return(0,p.jsx)(s.A,{style:{padding:"0px 10px 10px"},children:(0,p.jsx)(r.Ay,{multiple:!0,size:"small",options:m,value:x,onChange:(e,t,a)=>f(t),getOptionLabel:e=>e.name,getOptionSelected:(e,t)=>(null===e||void 0===e?void 0:e.id)===(null===t||void 0===t?void 0:t.id)||(null===e||void 0===e?void 0:e.name.toLowerCase())===(null===t||void 0===t?void 0:t.name.toLowerCase()),renderTags:(e,t)=>e.map((e,a)=>(0,p.jsx)(i.A,(0,n.A)((0,n.A)({variant:"outlined",style:{backgroundColor:"#bfbfbf",textShadow:"1px 1px 1px #000",color:"white"},label:e.name},t({index:a})),{},{size:"small"}))),renderInput:e=>(0,p.jsx)(o.A,(0,n.A)((0,n.A)({},e),{},{variant:"outlined",placeholder:u.R.t("tickets.filters.user")}))})})}}}]);